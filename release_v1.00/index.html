<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ğŸˆ BALLOON BURST</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&family=Orbitron:wght@700&display=swap"
        rel="stylesheet" />

    <style>
        /* ===================================================
       å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ«
       æ·±ã¿ã®ã‚ã‚‹ãƒ€ãƒ¼ã‚¯ç³»ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§å¤§äººã£ã½ã
       =================================================== */
        /* htmlã«ã‚‚é«˜ã•ã‚’æŒ‡å®šã™ã‚‹ã¨iOSã§å®‰å®šã—ã¾ã™ */
        html {
            height: 100%;
            height: -webkit-fill-available;
            background-color: #87d8f5;
            background-image: linear-gradient(to bottom, #5bbfed 0%, #87d8f5 45%, #c9eeff 100%);
            background-attachment: fixed;
            background-size: cover;
            background-repeat: no-repeat;
        }

        body {
            width: 100vw;
            /* 100vhã§ã¯ãªãã€ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒãƒ¼ã‚’è€ƒæ…®ã—ãŸã€Œ100dvhã€ã‚’ä½¿ã† */
            height: 100dvh;
            min-height: -webkit-fill-available;
            /* iOSå‘ã‘ã®ä¿é™º */
            overflow: hidden;

            /* iOS Safariç‰¹æœ‰ã®ã€Œãƒã‚¦ãƒ³ã‚¹ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆã‚´ãƒ ãƒãƒ³ãƒ‰ç¾è±¡ï¼‰ã€ã‚’ç„¡åŠ¹åŒ– */
            overscroll-behavior: none;

            /* ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æç”»ãƒã‚°ã®å¯¾ç­– */
            background-color: #87d8f5;
            /* ä¸‡ãŒä¸€ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¤±æ•—ã—ãŸæ™‚ã®ä¿é™ºè‰² */
            background-image: linear-gradient(to bottom, #5bbfed 0%, #87d8f5 45%, #c9eeff 100%);
            background-attachment: fixed;
            background-size: cover;
            background-repeat: no-repeat;
            /* ã“ã‚Œã‚’å…¥ã‚Œã‚‹ã¨å¼·åˆ¶çš„ã«æ­£ã—ãæç”»ã•ã‚Œã¾ã™ */

            font-family: 'Noto Sans JP', sans-serif;
            cursor: default;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
            /* iOS Safari ã®ãƒ‘ãƒ³ã‚„ã‚ºãƒ¼ãƒ ã‚’CSSãƒ¬ãƒ™ãƒ«ã§å®Œå…¨ç„¡åŠ¹åŒ– */
        }



        /* ---------------------------------------------------
       é›²ã®è£…é£¾ï¼šç™½ã„ã‚‚ãã‚‚ãå½¢ã‚’å¾©å…ƒ
       --------------------------------------------------- */
        .cloud {
            position: absolute;
            background: white;
            border-radius: 50px;
            opacity: 0.88;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.08));
            animation: floatCloud linear infinite;
        }

        @keyframes floatCloud {
            from {
                transform: translateX(-200px);
            }

            to {
                transform: translateX(110vw);
            }
        }

        /* ---------------------------------------------------
       ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ï¼ˆã‚¹ã‚³ã‚¢ï¼‹æ®‹ã‚Šæ™‚é–“ï¼‰
       --------------------------------------------------- */
        #statusBar {
            position: fixed;
            top: 16px;
            left: 0;
            width: 100%;
            padding: 0 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        /* ã‚¹ã‚³ã‚¢è¡¨ç¤º */
        #scoreBoard {
            background: rgba(0, 20, 60, 0.45);
            /* å°‘ã—æ·±ã¿ã®ã‚ã‚‹åŠé€æ˜ãƒ‘ãƒãƒ« */
            backdrop-filter: blur(14px);
            border: 1.5px solid rgba(255, 255, 255, 0.35);
            border-radius: 12px;
            padding: 10px 28px;
            font-size: 1rem;
            letter-spacing: 0.08em;
            color: rgba(255, 255, 255, 0.95);
            /* ã»ã¼ç™½ */
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            white-space: nowrap;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 1px 6px rgba(0, 0, 0, 0.6);
        }

        #scoreBoard span {
            font-size: 1.3rem;
            /* 1.6remã‹ã‚‰ç¸®å°ã—ã¦ã¯ã¿å‡ºã—ã‚’é˜²æ­¢ */
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 0 12px rgba(120, 200, 255, 0.7), 0 1px 4px rgba(0, 0, 0, 0.8);
            font-variant-numeric: tabular-nums;
            /* æ•°å­—ã®å¹…ã‚’å›ºå®šã—ã¦ã‚¬ã‚¿ãƒ„ã‚­ã‚’é˜²æ­¢ */
        }

        /* ---------------------------------------------------
       æ®‹ã‚Šæ™‚é–“è¡¨ç¤º
       --------------------------------------------------- */
        #timerBoard {
            background: rgba(0, 20, 60, 0.45);
            backdrop-filter: blur(14px);
            border: 1.5px solid rgba(255, 255, 255, 0.35);
            border-radius: 12px;
            padding: 10px 28px;
            font-size: 1rem;
            letter-spacing: 0.08em;
            color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
            white-space: nowrap;
            transition: border-color 0.3s, color 0.3s, background 0.3s;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 1px 6px rgba(0, 0, 0, 0.6);
        }

        #timerBoard span {
            font-size: 1.3rem;
            /* 1.6remã‹ã‚‰ç¸®å°ã—ã¦ã¯ã¿å‡ºã—ã‚’é˜²æ­¢ */
            font-weight: bold;
            text-shadow: 0 0 12px rgba(120, 200, 255, 0.7), 0 1px 4px rgba(0, 0, 0, 0.8);
            font-variant-numeric: tabular-nums;
            /* æ•°å­—ã®å¹…ã‚’å›ºå®šã—ã¦ã‚¬ã‚¿ãƒ„ã‚­ã‚’é˜²æ­¢ */
        }

        /* æ¨ªå¹…ã®ç‹­ã„ã‚¹ãƒãƒ›å‘ã‘ï¼ˆ480pxä»¥ä¸‹ï¼‰ã«2æ®µçµ„ã¿ã¸å¤‰æ›´ */
        @media (max-width: 480px) {

            #statusBar {
                padding: 0 12px;
                top: 10px;
                flex-direction: column;
                align-items: stretch;
                gap: 6px;
                pointer-events: none;
                /* å¥¥ã®ã‚¿ãƒƒãƒ—ã‚’é‚ªé­”ã—ãªã„ */
            }

            #scoreBoard,
            #timerBoard {
                padding: 4px 14px;
                font-size: 0.85rem;
                letter-spacing: 0.05em;
                display: flex;
                justify-content: space-between;
                align-items: center;
                pointer-events: auto;
                /* ãƒœã‚¿ãƒ³éƒ¨åˆ†ã¯ã‚¿ãƒƒãƒ—ä¸å¯ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ãŒã€å…ƒã€…ãŸã ã®è¡¨ç¤ºã ãŒä¸€å¿œ */
            }

            #scoreBoard span,
            #timerBoard span {
                font-size: 1.15rem;
            }
        }

        /* æ®‹ã‚Š5ç§’ä»¥ä¸‹ã«ãªã£ãŸã‚‰èµ¤ãè­¦å‘Š */
        #timerBoard.danger {
            border-color: rgba(255, 71, 87, 0.7);
            color: #ff6b6b;
            animation: pulse 0.6s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from {
                transform: scale(1);
            }

            to {
                transform: scale(1.05);
            }
        }

        /* ---------------------------------------------------
       é¢¨èˆ¹ã®ã‚¹ã‚¿ã‚¤ãƒ«
       --------------------------------------------------- */
        .balloon {
            position: absolute;
            cursor: pointer;
            transform-origin: center bottom;
            will-change: transform, top;
            z-index: 5;
            /* é¢¨èˆ¹ã¯ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ï¼ˆz-index:2ï¼‰ã‚ˆã‚Šå‰é¢ */
            touch-action: none;
            /* é¢¨èˆ¹ã«å¯¾ã™ã‚‹æ„å›³ã—ãªã„æ¨™æº–ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç„¡åŠ¹åŒ– */
        }

        .balloon svg {
            display: block;
            filter: drop-shadow(2px 3px 4px rgba(0, 0, 0, 0.25));
        }

        /* ã‚¹ãƒãƒ›å‘ã‘ï¼šé‡ã„ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ç°¡ç•¥åŒ– */
        @media (max-width: 768px) {

            .balloon svg,
            .cloud {
                filter: none;
            }
        }

        .balloon .string {
            display: block;
            width: 2px;
            height: 40px;
            background: rgba(0, 0, 0, 0.35);
            margin: 0 auto;
            border-radius: 2px;
        }

        /* ---------------------------------------------------
       ã‚ã‚‹ã„é¢¨èˆ¹ï¼ˆãŠé‚ªé­”ã‚­ãƒ£ãƒ©ï¼‰ã®ç´ã¯æš—ã„è‰²ã«ã™ã‚‹
       --------------------------------------------------- */
        .balloon.bad .string {
            background: rgba(80, 0, 0, 0.6);
        }

        /* ---------------------------------------------------
       ç ´è£‚ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
       --------------------------------------------------- */
        .pop-effect {
            position: absolute;
            pointer-events: none;
            z-index: 50;
            animation: popAnim 0.5s ease-out forwards;
        }

        @keyframes popAnim {
            0% {
                transform: scale(0.5);
                opacity: 1;
            }

            60% {
                transform: scale(1.6);
                opacity: 0.8;
            }

            100% {
                transform: scale(2.2);
                opacity: 0;
            }
        }

        /* æµ®éŠãƒ†ã‚­ã‚¹ãƒˆå…±é€šãƒ™ãƒ¼ã‚¹ */
        .float-label {
            position: absolute;
            pointer-events: none;
            font-weight: bold;
            text-shadow: 1px 1px 0 #fff, -1px -1px 0 #fff;
            z-index: 60;
        }

        .pop-text {
            font-size: 1.8rem;
            color: #ff4500;
            animation: floatUp 0.7s ease-out forwards;
        }

        .bad-text {
            font-size: 1.6rem;
            color: #cc0000;
            animation: floatUp 0.9s ease-out forwards;
        }

        .score-add {
            font-size: 1.4rem;
            color: #2ecc71;
            animation: floatUp 0.8s ease-out forwards;
        }

        .score-sub {
            font-size: 1.6rem;
            color: #e03030;
            animation: floatUp 0.9s ease-out forwards;
        }

        .score-special {
            font-size: 2.2rem;
            color: #FFD700;
            text-shadow: 1px 1px 0 #b8860b, -1px -1px 0 #b8860b, 0 0 10px #FFD700;
            animation: floatUp 1s ease-out forwards;
        }

        .score-super-rare {
            font-size: 2.8rem;
            color: #00FF00;
            font-weight: 900;
            text-shadow: 2px 2px 0 #005500, -2px -2px 0 #005500, 2px -2px 0 #005500, -2px 2px 0 #005500, 0 0 20px #00FF00;
            animation: floatUp 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            z-index: 100;
        }

        .time-add {
            font-size: 2rem;
            color: #FFFFFF;
            font-weight: 900;
            text-shadow: 2px 2px 0 #FF007F, -2px -2px 0 #FF007F, 2px -2px 0 #FF007F, -2px 2px 0 #FF007F, 0 4px 8px rgba(0, 0, 0, 0.6);
            animation: floatUp 1s ease-out forwards;
            z-index: 100;
        }

        .time-sub {
            font-size: 2.2rem;
            color: #FFFFFF;
            font-weight: 900;
            text-shadow: 2px 2px 0 #0055FF, -2px -2px 0 #0055FF, 2px -2px 0 #0055FF, -2px 2px 0 #0055FF, 0 4px 8px rgba(0, 0, 0, 0.6);
            animation: dropDown 1s ease-out forwards;
            z-index: 100;
        }

        .special-text {
            font-size: 2rem;
            color: #FFD700;
            text-shadow: 1px 1px 0 #b8860b, -1px -1px 0 #b8860b, 0 0 14px rgba(255, 215, 0, 0.8);
            animation: floatUp 1s ease-out forwards;
        }

        .super-rare-text {
            font-size: 2.5rem;
            color: #00FF00;
            font-weight: 900;
            text-shadow: 2px 2px 0 #005500, -2px -2px 0 #005500, 0 0 20px rgba(0, 255, 0, 0.9);
            animation: floatUp 1.2s ease-out forwards;
            z-index: 100;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }

            100% {
                transform: translateY(-70px) scale(1.3);
                opacity: 0;
            }
        }

        @keyframes dropDown {
            0% {
                transform: translateY(0) scale(1.4);
                opacity: 1;
            }

            100% {
                transform: translateY(40px) scale(1);
                opacity: 0;
            }
        }

        .balloon.special {
            animation: specialBounce 0.7s ease-in-out infinite alternate;
        }

        .balloon.super-rare {
            animation: superRarePulse 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite alternate;
            z-index: 100 !important;
        }

        /* ã‚·ãƒ¥ãƒ¼ãƒ«ãªãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆç”¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”»åƒ */
        .surreal-pop {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            transform: translate(-50%, -50%);
            animation: surrealFadeOut 2s forwards ease-in-out;
            max-width: 80vw;
            max-height: 80vh;
            /* åŠ å·¥ã›ãšå…ƒç”»åƒã®ã¾ã¾è¡¨ç¤º */
        }

        @keyframes surrealFadeOut {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(0.8) translateY(0);
            }

            10% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.0) translateY(-10px);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(1.0) translateY(-100px);
            }

            /* ãã®ã¾ã¾ä¸Šã«ã‚¹ãƒ¼ãƒƒã¨æ¶ˆãˆã‚‹ */
        }

        .balloon.super-bad {
            animation: superBadPulse 0.9s ease-in-out infinite alternate;
        }

        @keyframes specialBounce {
            from {
                transform: scale(1);
                opacity: 1;
            }

            to {
                transform: scale(1.08);
                opacity: 0.82;
            }
        }

        @keyframes superBadPulse {
            from {
                transform: scale(1);
                opacity: 1;
            }

            to {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        /* ---------------------------------------------------
       ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤å…±é€šï¼šæ¯›ã‚¬ãƒ©ã‚¹ï¼‹ãƒ€ãƒ¼ã‚¯
       --------------------------------------------------- */
        .overlay {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(5, 10, 30, 0.82);
            backdrop-filter: blur(10px);
            z-index: 200;
        }

        .overlay h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.8rem, 6vw, 3.5rem);
            color: #e2e8f0;
            text-shadow: 0 0 20px rgba(100, 180, 255, 0.5);
            margin-bottom: 16px;
            line-height: 1.3;
            text-align: center;
            letter-spacing: 0.1em;
        }

        .overlay p {
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 10px;
            text-align: center;
            letter-spacing: 0.04em;
        }

        /* ---------------------------------------------------
       ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ«
       --------------------------------------------------- */
        .game-btn {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            letter-spacing: 0.12em;
            padding: 14px 48px;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s, opacity 0.1s;
            margin-top: 24px;
            text-transform: uppercase;
            touch-action: manipulation;
            /* ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹æ™‚ã®ã¿æ¨™æº–ã®æ“ä½œã‚’è¨±å¯ï¼ˆã‚ºãƒ¼ãƒ ã¯ã—ãªã„è¨­å®šï¼‰ */
        }

        .game-btn.orange {
            background: linear-gradient(135deg, #3b82f6, #6366f1);
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.5), 0 2px 0 #312e81;
        }

        .game-btn.orange:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 28px rgba(99, 102, 241, 0.6), 0 4px 0 #312e81;
        }

        .game-btn.orange:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(99, 102, 241, 0.4), 0 0 0 #312e81;
        }

        .game-btn.blue {
            background: linear-gradient(135deg, #0ea5e9, #06b6d4);
            box-shadow: 0 4px 20px rgba(14, 165, 233, 0.5), 0 2px 0 #0369a1;
        }

        .game-btn.blue:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 28px rgba(14, 165, 233, 0.55), 0 4px 0 #0369a1;
        }

        .game-btn.blue:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(14, 165, 233, 0.4), 0 0 0 #0369a1;
        }

        /* ---------------------------------------------------
       çµæœç”»é¢ã®ã‚¹ã‚³ã‚¢è¡¨ç¤º
       --------------------------------------------------- */
        #resultScore {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(3rem, 12vw, 6rem);
            font-weight: bold;
            color: #e2e8f0;
            text-shadow: 0 0 30px rgba(100, 180, 255, 0.6);
            line-height: 1;
            margin: 8px 0;
        }

        /* çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        #resultMsg {
            font-size: clamp(1rem, 3vw, 1.4rem);
            color: rgba(255, 255, 255, 0.55);
            letter-spacing: 0.06em;
            margin-bottom: 4px;
        }

        /* ---------------------------------------------------
           ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã ã‘æ˜ã‚‹ãå¯æ„›ã„é›°å›²æ°—ã«ä¸Šæ›¸ãã™ã‚‹
           ã‚²ãƒ¼ãƒ ä¸­ãƒ»çµæœç”»é¢ã®ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã¨ã¯ç‹¬ç«‹ã—ãŸè¨­å®š
        --------------------------------------------------- */
        #titleOverlay {
            /* æ™´ã‚ŒãŸé’ç©ºã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ãŸã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */
            background: linear-gradient(to bottom,
                    rgba(100, 190, 240, 0.95) 0%,
                    rgba(160, 220, 255, 0.95) 50%,
                    rgba(220, 243, 255, 0.95) 100%);
            backdrop-filter: blur(8px);
        }

        /* ã‚¿ã‚¤ãƒˆãƒ«ã¯é’ç©ºã«æ˜ ãˆã‚‹æ·±ã„æµ·è‰²ã« */
        #titleOverlay h1 {
            font-family: 'Noto Sans JP', sans-serif;
            font-size: clamp(2rem, 8vw, 4rem);
            color: #0e5c8a;
            text-shadow: 2px 3px 0 rgba(255, 255, 255, 0.7),
                0 0 24px rgba(100, 200, 255, 0.4);
            letter-spacing: 0.06em;
            animation: titleBreath 1.4s ease-in-out infinite alternate;
        }

        @keyframes titleBreath {
            from {
                transform: scale(1);
                opacity: 1;
                text-shadow: 2px 3px 0 rgba(255, 255, 255, 0.7), 0 0 24px rgba(100, 200, 255, 0.3);
            }

            to {
                transform: scale(1.14);
                opacity: 0.82;
                text-shadow: 2px 3px 0 rgba(255, 255, 255, 0.9), 0 0 60px rgba(100, 200, 255, 1), 0 0 100px rgba(80, 160, 255, 0.6);
            }
        }

        /* ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚’ã‚³ãƒ¼ãƒ©ãƒ«ãƒ”ãƒ³ã‚¯ã« */
        #startBtn {
            background: linear-gradient(135deg, #ff7aa2, #ff9a5c);
            box-shadow: 0 4px 20px rgba(255, 122, 162, 0.5), 0 2px 0 #c04060;
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 1.2rem;
            letter-spacing: 0.06em;
            animation: btnFloat 0.7s ease-in-out infinite alternate;
        }

        @keyframes btnFloat {
            from {
                transform: translateY(0px) scale(1);
                box-shadow: 0 4px 20px rgba(255, 122, 162, 0.5), 0 2px 0 #c04060;
            }

            to {
                transform: translateY(-18px) scale(1.1);
                box-shadow: 0 24px 48px rgba(255, 122, 162, 0.75), 0 6px 0 #c04060;
            }
        }

        #startBtn:hover {
            box-shadow: 0 8px 28px rgba(255, 122, 162, 0.6), 0 4px 0 #c04060;
        }

        /* ---------------------------------------------------
           çµæœç”»é¢ã‚‚ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã¨åŒã˜é’ç©ºãƒ†ãƒ¼ãƒã«çµ±ä¸€ã™ã‚‹
        --------------------------------------------------- */
        /* ---------------------------------------------------
           ãƒªã‚¶ãƒ«ãƒˆç”»é¢ï¼šå¤¢ã®æ˜Ÿç©ºãƒ†ãƒ¼ãƒ
        --------------------------------------------------- */
        #resultOverlay {
            background: linear-gradient(to bottom,
                    #0a0520 0%,
                    #0d1440 35%,
                    #1a0a3a 65%,
                    #2a0e1e 100%);
            backdrop-filter: blur(4px);
        }

        #resultOverlay h1 {
            font-family: 'Orbitron', sans-serif;
            color: #e8d8ff;
            text-shadow: 0 0 20px rgba(180, 140, 255, 0.8),
                0 0 40px rgba(140, 80, 255, 0.4);
            letter-spacing: 0.1em;
        }

        #resultScore {
            color: #ffe97a;
            text-shadow: 0 0 20px rgba(255, 220, 100, 0.8),
                0 0 40px rgba(255, 160, 40, 0.4);
        }

        #resultMsg {
            color: rgba(200, 180, 255, 0.8);
            letter-spacing: 0.06em;
        }

        /* æ˜Ÿã®ãƒ„ã‚¤ãƒ³ã‚¯ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        .star {
            position: absolute;
            border-radius: 50%;
            background: white;
            animation: twinkle var(--dur) ease-in-out infinite alternate;
        }

        @keyframes twinkle {
            from {
                opacity: var(--lo);
                transform: scale(1);
            }

            to {
                opacity: var(--hi);
                transform: scale(1.6);
            }
        }

        /* ---------------------------------------------------
           ãƒ•ã‚£ãƒ¼ãƒãƒ¼ãƒãƒŠãƒ¼ï¼ˆç”»é¢ä¸­å¤®ã«ä¸€ç¬è¡¨ç¤ºï¼‰
        --------------------------------------------------- */
        #feverBanner {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            z-index: 2;
            /* é¢¨èˆ¹ï¼ˆz-index:5ï¼‰ã®å¾Œã‚ã«ç§»å‹• */
        }

        #feverBanner .fever-text {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.6rem, 5vw, 3rem);
            /* åŠåˆ†ç¨‹åº¦ã«ç¸®å° */
            font-weight: bold;
            color: rgba(255, 255, 255, 0.6);
            /* å¤‰é€æ˜åº¦ã‚’ä¸‹ã’ã‚‹ */
            text-shadow:
                0 0 12px #ff0,
                0 0 24px #f80;
            letter-spacing: 0.12em;
            animation: feverIn 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
        }

        @keyframes feverIn {
            from {
                transform: scale(0.4) rotate(-8deg);
                opacity: 0;
            }

            to {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        /* ãƒ•ã‚£ãƒ¼ãƒãƒ¼å‰ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ•°å­—ï¼ˆ5â†’â€¦â†’1ï¼‰ */
        #feverCountdown {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
            z-index: 2;
            /* é¢¨èˆ¹ï¼ˆz-index:5ï¼‰ã®å¾Œã‚ã€èƒŒæ™¯ã®å‰ */
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.55);
            text-shadow: 0 0 20px #f80, 0 0 50px #ff0;
            line-height: 1;
            text-align: center;
        }

        #feverCountdown .cd-label {
            font-size: clamp(1rem, 3vw, 1.5rem);
            letter-spacing: 0.2em;
            opacity: 0.9;
            margin-bottom: 8px;
            display: block;
        }

        #feverCountdown .cd-number {
            font-size: clamp(6rem, 20vw, 12rem);
            display: block;
            animation: countPop 0.25s cubic-bezier(0.22, 1, 0.36, 1) both;
        }

        @keyframes countPop {
            from {
                transform: scale(1.8);
                opacity: 0.4;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* ãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ã®è¦™ã®ç‚¹æ»…ãƒ­ãƒ¼ãƒ‰ï¼ˆbodyã«.feverã‚¯ãƒ©ã‚¹ã‚’ä»˜ã‘ã‚‹ï¼‰ */
        body.fever::after {
            content: '';
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1;
            animation: feverFlash 0.5s linear infinite alternate;
        }

        @keyframes feverFlash {
            0% {
                background: rgba(255, 100, 0, 0.08);
            }

            33% {
                background: rgba(255, 0, 150, 0.08);
            }

            66% {
                background: rgba(0, 180, 255, 0.08);
            }

            100% {
                background: rgba(255, 220, 0, 0.08);
            }
        }

        /* ---------------------------------------------------
           å‹•çš„ç”Ÿæˆã‚’é¿ã‘ã‚‹ãŸã‚ã®å…±é€šã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ 
        --------------------------------------------------- */
        @keyframes flashOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        @keyframes sparkAnim {
            0% {
                transform: translate(-50%, -50%) scale(var(--spark-scale-start, 1));
                opacity: 1;
            }

            100% {
                transform: translate(calc(-50% + var(--tx)), calc(-50% + var(--ty))) scale(0);
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <!-- =====================================================
       ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ï¼ˆã‚¹ã‚³ã‚¢ï¼‹æ®‹ã‚Šæ™‚é–“ï¼‰
       ã‚²ãƒ¼ãƒ ä¸­ã«å¸¸ã«ç”»é¢ä¸Šéƒ¨ã«è¡¨ç¤ºã•ã‚Œã‚‹
       ===================================================== -->
    <div id="statusBar">
        <div id="scoreBoard">SCORE &nbsp;<span id="scoreValue">00000</span> pts</div>
        <div id="timerBoard">TIME &nbsp;<span id="timerValue">30</span>s</div>
    </div>

    <!-- =====================================================
       ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ï¼ˆã‚²ãƒ¼ãƒ é–‹å§‹å‰ã«è¡¨ç¤ºï¼‰
       ===================================================== -->
    <div id="titleOverlay" class="overlay">
        <h1>ğŸˆ ãƒãƒ«ãƒ¼ãƒ³<br>ãƒãƒ¼ã‚¹ãƒˆï¼</h1>
        <p style="font-size:1.1rem; color:#1a5f8a; margin-bottom:6px;">ãƒãƒ«ãƒ¼ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦å‰²ã‚ã†ï¼</p>
        <p style="font-size:0.85rem; color:#2e7fa8;">
            âš ï¸ é»’ã„ãƒãƒ«ãƒ¼ãƒ³ã¯è§¦ã‚‰ãªã„ã§ï¼&nbsp;<strong style="color:#c03030;">âˆ’20 pts</strong>ãƒšãƒŠãƒ«ãƒ†ã‚£<br>
            â­ é‡‘ã®ãƒãƒ«ãƒ¼ãƒ³ã¯ãƒ¬ã‚¢ï¼&nbsp;<strong style="color:#9a7000;">+5 pts / +1ç§’</strong>ãƒœãƒ¼ãƒŠã‚¹<br>
            â˜ ï¸ èµ¤ã„ãƒãƒ«ãƒ¼ãƒ³ã¯å¤§å¤–ã‚Œï¼&nbsp;<strong style="color:#cc0000;">âˆ’50 pts / -2ç§’</strong>ã®å¤§ãƒšãƒŠãƒ«ãƒ†ã‚£
        </p>
        <button id="startBtn" class="game-btn orange">â–¶Â START</button>
    </div>

    <!-- =====================================================
       çµæœç”»é¢ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—å¾Œã«è¡¨ç¤ºï¼‰
       æœ€åˆã¯éè¡¨ç¤ºï¼ˆdisplay:noneï¼‰ã«ã—ã¦ãŠã
       ===================================================== -->
    <div id="resultOverlay" class="overlay" style="display:none;">
        <h1>TIME'S UP</h1>
        <p style="letter-spacing:0.1em;">FINAL SCORE</p>
        <div id="resultScore">0</div>
        <p id="resultMsg">WELL DONE</p>
        <button id="retryBtn" class="game-btn blue">â†º &nbsp;RETRY</button>
    </div>

    <script>
        // =====================================================
        // â‘  å®šæ•°ãƒ»è¨­å®šå€¤
        //    ã‚²ãƒ¼ãƒ ã®æŒ™å‹•ã‚’å¤‰ãˆãŸã„ã¨ãã¯ã“ã“ã‚’æ›¸ãæ›ãˆã‚‹
        // =====================================================

        // é€šå¸¸ã®é¢¨èˆ¹ã®è‰²ãƒªã‚¹ãƒˆï¼ˆã‚¯ãƒ¬ãƒ¨ãƒ³é¢¨ã®æ¸©ã‹ã¿ã®ã‚ã‚‹è‰²ï¼‰
        const BALLOON_COLORS = [
            '#FF4757', '#FF6B35', '#FFD700',
            '#2ED573', '#1E90FF', '#A855F7',
            '#FF69B4', '#00CEC9',
        ];

        const BALLOON_MIN_SIZE = 100;   // é¢¨èˆ¹ã®æœ€å°ã‚µã‚¤ã‚ºï¼ˆpxï¼‰
        const BALLOON_MAX_SIZE = 160;   // é¢¨èˆ¹ã®æœ€å¤§ã‚µã‚¤ã‚ºï¼ˆpxï¼‰
        const SPAWN_INTERVAL_MS = 350;   // é¢¨èˆ¹ãŒå‡ºç¾ã™ã‚‹é–“éš”ï¼ˆãƒŸãƒªç§’ï¼‰
        const BALLOON_SPEED_MIN = 2.8;   // é¢¨èˆ¹ã®ä¸Šæ˜‡é€Ÿåº¦ æœ€å°
        const BALLOON_SPEED_MAX = 5.0;   // é¢¨èˆ¹ã®ä¸Šæ˜‡é€Ÿåº¦ æœ€å¤§
        const SWAY_AMOUNT = 50;    // å·¦å³ã®æºã‚Œå¹…ï¼ˆpxï¼‰
        const SWAY_SPEED = 0.02;  // æºã‚Œã®é€Ÿã•

        // =====================================================
        // â‘¡ æ–°æ©Ÿèƒ½â‘ ã®å®šæ•°
        //    åˆ¶é™æ™‚é–“ã®ç§’æ•°
        // =====================================================
        const GAME_DURATION_SEC = 30; // ã‚²ãƒ¼ãƒ ã®åˆ¶é™æ™‚é–“ï¼ˆç§’ï¼‰

        // =====================================================
        // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ ã®å®šæ•°
        //    æ®‹ã‚Šæ™‚é–“ãŒ FEVER_START_SEC ç§’ã«ãªã£ãŸã‚‰ç™ºå‹•
        // =====================================================
        const FEVER_START_SEC = 10;   // ãƒ•ã‚£ãƒ¼ãƒãƒ¼é–‹å§‹ã®æ®‹ã‚Šç§’æ•°
        const FEVER_INTERVAL_MS = 80;   // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ã®ç”Ÿæˆé–“éš”ï¼ˆmsï¼‰â†“120â†’80ã§å¯†åº¦ã‚¢ãƒƒãƒ—
        const FEVER_SCORE_MULT = 2;    // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ã®é€šå¸¸é¢¨èˆ¹ã‚¹ã‚³ã‚¢å€ç‡
        const FEVER_COUNTDOWN_SEC = 5;   // ãƒ•ã‚£ãƒ¼ãƒãƒ¼å‰ã«è¡¨ç¤ºã™ã‚‹ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ç§’æ•°
        const FEVER_SPEED_MULT = 1.8;  // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ã®é¢¨èˆ¹ä¸Šæ˜‡é€Ÿåº¦å€ç‡

        // =====================================================
        // â‘¢ æ–°æ©Ÿèƒ½â‘¢ã®å®šæ•°
        //    ãŠé‚ªé­”ã‚­ãƒ£ãƒ©ï¼ˆã‚ã‚‹ã„é¢¨èˆ¹ï¼‰ã®å‡ºç¾ç¢ºç‡ã¨ãƒšãƒŠãƒ«ãƒ†ã‚£
        // =====================================================
        const BAD_BALLOON_CHANCE = 0.2;  // 20%ã®ç¢ºç‡ã§ã‚ã‚‹ã„é¢¨èˆ¹ã«ãªã‚‹
        const BAD_BALLOON_PENALTY = 200;   // ã‚ã‚‹ã„é¢¨èˆ¹ã‚’å‰²ã£ãŸã¨ãã®æ¸›ç‚¹

        // =====================================================
        // â‘¢'' å¤§å¤–ã‚Œè¶…ãƒãƒƒãƒ‰é¢¨èˆ¹ã®å®šæ•°
        //    ãƒ¬ã‚¢é¢¨èˆ¹ã‚ˆã‚Šã•ã‚‰ã«å°‘ãªã„å‡ºç¾æ©Ÿç‡ã§å¤§å¹…æ¸›ç‚¹
        // =====================================================
        const SUPER_BAD_CHANCE = 0.04;  // 4%ã®ç¢ºç‡ã§å‡ºã‚‹ï¼ˆé‡‘é¢¨èˆ¹ã®8%ã‚ˆã‚Šå°‘ãªã„ï¼‰
        const SUPER_BAD_PENALTY = 500;   // å‰²ã‚‹ã¨ -500ç‚¹ã®å¤§å¹…ãƒšãƒŠãƒ«ãƒ†ã‚£

        // =====================================================
        // â‘¢' ç‰¹åˆ¥ãªé«˜å¾—ç‚¹é¢¨èˆ¹ã®å®šæ•°
        //    ãƒ¬ã‚¢é¢¨èˆ¹ï¼šå‡ºç¾ç¢ºç‡ã¯ä½ã‚ã ãŒãŸãã•ã‚“ç‚¹ãŒå…¥ã‚‹
        // =====================================================
        const SPECIAL_BALLOON_CHANCE = 0.08; // 8%ã®ç¢ºç‡ã§ãƒ¬ã‚¢é¢¨èˆ¹ãŒå‡ºã‚‹
        const SPECIAL_BALLOON_POINTS = 100;  // ãƒ¬ã‚¢é¢¨èˆ¹ã‚’å‰²ã£ãŸã¨ãã®åŠ ç‚¹ï¼ˆ+100ptsï¼‰

        // =====================================================
        // â‘¢'' æ¿€ãƒ¬ã‚¢å¤§é€†è»¢ã‚¢ã‚¤ãƒ†ãƒ ã®å®šæ•°
        //    ãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ã®ã¿æ¥µä½ç¢ºç‡(0.1%)ã§å‡ºç¾ã™ã‚‹è¶…é«˜å¾—ç‚¹ã‚¢ã‚¤ãƒ†ãƒ 
        // =====================================================
        const SUPER_RARE_CHANCE = 0.001;     // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ã®ã¿ 0.1%ã®ç¢ºç‡ã§å‡ºç¾
        const SUPER_RARE_POINTS = 3000;     // å¤§é€†è»¢ç”¨ã®è¶…é«˜å¾—ç‚¹ï¼ˆ+3000ptsï¼‰

        // =====================================================
        // â‘£ ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        // =====================================================
        let score = 0;
        let balloons = [];
        let spawnTimer = null;
        let countdownTimer = null;
        let animationId = null;
        let timeLeft = GAME_DURATION_SEC;
        let gameRunning = false;
        let frame = 0;
        let feverActive = false;  // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ ä¸­ã‹ã©ã†ã‹
        let superRareSpawned = false; // å¤§é€†è»¢ã‚¢ã‚¤ãƒ†ãƒ ãŒã“ã®ã‚²ãƒ¼ãƒ ã§å‡ºç¾ã—ãŸã‹
        let feverTimeElapsed = 0;     // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ ãŒå§‹ã¾ã£ã¦ã‹ã‚‰ã®çµŒéç§’æ•°ï¼ˆç¢ºç‡ä¸Šæ˜‡ç”¨ï¼‰

        // =====================================================
        // â‘¤ Web Audio API ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        //    éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ä¸è¦ã§ãƒ–ãƒ©ã‚¦ã‚¶ã ã‘ã§éŸ³ã‚’é³´ã‚‰ã™
        // =====================================================
        let audioCtx = null;

        /** AudioContextã‚’åˆæœŸåŒ–ã™ã‚‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¾Œã«å‘¼ã¶å¿…è¦ãŒã‚ã‚‹ï¼‰ */
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        /**
         * ã€Œãƒãƒ³ï¼ã€ã¨ã„ã†é€šå¸¸ã®ç ´è£‚éŸ³ã‚’é³´ã‚‰ã™
         * ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚ºã‚’çŸ­ãé³´ã‚‰ã™ã“ã¨ã§ç ´è£‚éŸ³ã‚’è¡¨ç¾ã™ã‚‹
         */
        function playPopSound() {
            if (!audioCtx) return;

            const bufferSize = audioCtx.sampleRate * 0.08;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1; // ãƒ©ãƒ³ãƒ€ãƒ ãƒã‚¤ã‚º
            }

            const source = audioCtx.createBufferSource();
            source.buffer = buffer;
            const gainNode = audioCtx.createGain();
            gainNode.gain.setValueAtTime(0.6, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.08);

            source.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            source.start();
            source.stop(audioCtx.currentTime + 0.1);
        }

        /**
         * =====================================================
         * æ–°æ©Ÿèƒ½â‘¢ ã‚ã‚‹ã„é¢¨èˆ¹ã‚’å‰²ã£ãŸã¨ãã®ãƒ–ã‚¶ãƒ¼éŸ³
         * =====================================================
         * ä½ã„ã€Œãƒ–ã€œï¼ã€ã¨ã„ã†éŸ³ã‚’é³´ã‚‰ã™ã“ã¨ã§ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’è¡¨ç¾ã™ã‚‹
         * OscillatorNodeï¼ˆæ³¢å½¢ç™ºç”Ÿå™¨ï¼‰ã‚’ä½¿ã£ã¦éŸ³ç¨‹ã®ã‚ã‚‹éŸ³ã‚’ä½œã‚‹
         */
        function playBuzzerSound() {
            if (!audioCtx) return;

            // OscillatorNodeï¼šæŒ‡å®šã—ãŸå‘¨æ³¢æ•°ã®æ³¢ã‚’ç”Ÿæˆã™ã‚‹ãƒãƒ¼ãƒ‰
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            osc.type = 'sawtooth'; // ãƒã‚³ã‚®ãƒªæ³¢ï¼šã–ã‚‰ã–ã‚‰ã—ãŸéŸ³ã«ãªã‚‹
            osc.frequency.setValueAtTime(120, audioCtx.currentTime); // ä½ã„éŸ³ï¼ˆHzï¼‰
            // æ™‚é–“ã¨ã¨ã‚‚ã«éŸ³ã‚’å°‘ã—ä¸‹ã’ã¦ãƒ–ã‚¶ãƒ¼ã£ã½ãã™ã‚‹
            osc.frequency.exponentialRampToValueAtTime(60, audioCtx.currentTime + 0.3);

            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.35);

            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start(audioCtx.currentTime);
            osc.stop(audioCtx.currentTime + 0.35);
        }

        /**
         * =====================================================
         * å¤§å¤–ã‚Œãƒãƒƒãƒ‰é¢¨èˆ¹ã‚’å‰²ã£ãŸã¨ãã®ã‚¢ãƒ©ãƒ¼ãƒ éŸ³
         * =====================================================
         * é€šå¸¸ãƒ–ã‚¶ãƒ¼ã‚ˆã‚Šé•·ããƒ»å¤§ããé³´ã£ã¦ã€Œã‚„ã°ã„ï¼ã€æ„Ÿã‚’å¼·èª¿
         */
        function playSuperBadAlarm() {
            if (!audioCtx) return;
            // ä¸‹é™¸ã™ã‚‹éœ§ã§ã€Œã‚¦ã‚©ã‚¦ã‚¦ã‚¦Â·Â·Â·ã€ãªã‚¢ãƒ©ãƒ¼ãƒ éŸ³
            const t = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(220, t);
            osc.frequency.linearRampToValueAtTime(80, t + 0.2);
            osc.frequency.linearRampToValueAtTime(220, t + 0.4);
            osc.frequency.linearRampToValueAtTime(80, t + 0.6);
            gain.gain.setValueAtTime(0.7, t);
            gain.gain.exponentialRampToValueAtTime(0.001, t + 0.7);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(t);
            osc.stop(t + 0.7);
        }

        /**
         * =====================================================
         * ãƒ¬ã‚¢é¢¨èˆ¹ã‚’å‰²ã£ãŸã¨ãã®ãƒ•ã‚¡ãƒ³ãƒ•ã‚¡ãƒ¼ãƒ¬éŸ³
         * =====================================================
         * ãƒ‰ãƒ»ãƒŸãƒ»ã‚½ã¨éŸ³ç¨‹ãŒä¸ŠãŒã‚‹ãƒ¡ãƒ­ãƒ‡ã‚£ã‚’é³´ã‚‰ã—ã¦
         * ã€Œå½“ãŸã£ãŸï¼ã€ã¨ã„ã†é”æˆæ„Ÿã‚’è¡¨ç¾ã™ã‚‹
         */
        function playFanfareSound() {
            if (!audioCtx) return;

            // é³´ã‚‰ã™éŸ³ã®å‘¨æ³¢æ•°ã¨é–‹å§‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’é…åˆ—ã§å®šç¾©ã™ã‚‹
            // ãƒ‰(523Hz)â†’ãƒŸ(659Hz)â†’ã‚½(784Hz) ã®3éŸ³ã‚’ç´ æ—©ãé³´ã‚‰ã™
            const notes = [
                { freq: 523, time: 0.00 },  // ãƒ‰
                { freq: 659, time: 0.12 },  // ãƒŸ
                { freq: 784, time: 0.24 },  // ã‚½
            ];

            notes.forEach(({ freq, time }) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();

                osc.type = 'sine'; // ã‚µã‚¤ãƒ³æ³¢ï¼šã¾ã‚ã‚„ã‹ã§æ˜ã‚‹ã„éŸ³
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + time);

                gain.gain.setValueAtTime(0, audioCtx.currentTime + time);
                gain.gain.linearRampToValueAtTime(0.4, audioCtx.currentTime + time + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + time + 0.2);

                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + time);
                osc.stop(audioCtx.currentTime + time + 0.25);
            });
        }

        /**
         * =====================================================
         * æ¿€ãƒ¬ã‚¢ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰²ã£ãŸã¨ãã®å¤§æ­“å£°éŸ³
         * =====================================================
         * ã‚­ãƒ©ã‚­ãƒ©ã—ãŸéŸ³è‰²ã‚’æ´¾æ‰‹ã«é³´ã‚‰ã™
         */
        function playSuperRareSound() {
            if (!audioCtx) return;
            // ç´ æ—©ã„ã‚¢ãƒ«ãƒšã‚¸ã‚ªï¼ˆå’ŒéŸ³ã®åˆ†æ•£ï¼‰ã§æ´¾æ‰‹ã•ã‚’æ¼”å‡º
            const notes = [
                { freq: 523, time: 0.0 },   // C5
                { freq: 659, time: 0.05 },  // E5
                { freq: 784, time: 0.1 },   // G5
                { freq: 1047, time: 0.15 }, // C6
                { freq: 1319, time: 0.2 },  // E6
                { freq: 1568, time: 0.25 }, // G6
                { freq: 2093, time: 0.3 }   // C7
            ];

            notes.forEach(({ freq, time }) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();

                osc.type = 'triangle'; // ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«æ³¢ï¼šé›»å­éŸ³çš„ãªã‚¯ãƒªã‚¢ã•
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + time);

                gain.gain.setValueAtTime(0, audioCtx.currentTime + time);
                gain.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + time + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + time + 0.3);

                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + time);
                osc.stop(audioCtx.currentTime + time + 0.35);
            });

            // ä¸‹åœ°ã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚¤ã‚ºï¼ˆæ­“å£°ã£ã½ã„éŸ³ï¼‰
            const bufferSize = audioCtx.sampleRate * 0.5;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            const noiseSource = audioCtx.createBufferSource();
            noiseSource.buffer = buffer;
            const noiseFilter = audioCtx.createBiquadFilter();
            noiseFilter.type = 'lowpass';
            noiseFilter.frequency.value = 1000;
            const noiseGain = audioCtx.createGain();
            noiseGain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            noiseGain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);

            noiseSource.connect(noiseFilter);
            noiseFilter.connect(noiseGain);
            noiseGain.connect(audioCtx.destination);
            noiseSource.start();
        }

        // =====================================================
        // â‘¥ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        // =====================================================

        /** æŒ‡å®šã—ãŸç¯„å›²ã§ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å€¤ã‚’è¿”ã™ */
        function randomBetween(min, max) {
            return Math.random() * (max - min) + min;
        }

        /**
         * 16é€²æ•°ã‚«ãƒ©ãƒ¼ã‚’æ˜æš—èª¿æ•´ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼
         * @param {string} hex    - å…ƒã®è‰²ï¼ˆä¾‹ï¼š'#FF4757'ï¼‰
         * @param {number} amount - æ­£ã§æ˜ã‚‹ãã€è² ã§æš—ã
         */
        function shadeColor(hex, amount) {
            let r = parseInt(hex.slice(1, 3), 16);
            let g = parseInt(hex.slice(3, 5), 16);
            let b = parseInt(hex.slice(5, 7), 16);
            r = Math.max(0, Math.min(255, r + amount));
            g = Math.max(0, Math.min(255, g + amount));
            b = Math.max(0, Math.min(255, b + amount));
            return `rgb(${r},${g},${b})`;
        }

        // =====================================================
        // â‘¦ é¢¨èˆ¹ SVG ã®ç”Ÿæˆ
        // =====================================================

        /**
         * é€šå¸¸ã®é¢¨èˆ¹ã® SVG æ–‡å­—åˆ—ã‚’è¿”ã™
         * ã‚¯ãƒ¬ãƒ¨ãƒ³é¢¨ã®æ‰‹æ›¸ãã£ã½ã„ãƒ‡ã‚¶ã‚¤ãƒ³
         */
        function createBalloonSVG(color, size) {
            const w = size;
            const h = size * 1.25;
            const shadowColor = shadeColor(color, -30);
            return `
        <svg width="${w}" height="${h}" viewBox="0 0 100 125" xmlns="http://www.w3.org/2000/svg">
          <ellipse cx="52" cy="72" rx="36" ry="32" fill="${shadowColor}" opacity="0.3"/>
          <ellipse cx="50" cy="52" rx="35" ry="45"
            fill="${color}" stroke="${shadowColor}"
            stroke-width="2" stroke-linejoin="round"/>
          <ellipse cx="38" cy="34" rx="10" ry="14"
            fill="white" opacity="0.4" transform="rotate(-20 38 34)"/>
          <polygon points="50,95 44,104 56,104" fill="${shadowColor}" opacity="0.8"/>
          <ellipse cx="50" cy="52" rx="35" ry="45"
            fill="none" stroke="${shadowColor}"
            stroke-width="2.5" stroke-dasharray="4,1" opacity="0.5"/>
        </svg>`;
        }

        /**
         * =====================================================
         * æ–°æ©Ÿèƒ½â‘¢ ã‚ã‚‹ã„é¢¨èˆ¹ã® SVG æ–‡å­—åˆ—ã‚’è¿”ã™
         * =====================================================
         * æš—ç´«è‰²ã€œé»’ã¿ãŒã‹ã£ãŸãƒ‡ã‚¶ã‚¤ãƒ³ã«ã€ã‚¬ã‚¤ã‚³ãƒ„ãƒãƒ¼ã‚¯ã‚„
         * ã‚®ã‚¶ã‚®ã‚¶ã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã§ã€Œã‚ã‚‹ã‚‚ã®æ„Ÿã€ã‚’è¡¨ç¾ã™ã‚‹
         */
        function createBadBalloonSVG(size) {
            const w = size;
            const h = size * 1.25;
            return `
        <svg width="${w}" height="${h}" viewBox="0 0 100 125" xmlns="http://www.w3.org/2000/svg">
          <!-- ãŠé‚ªé­”é¢¨èˆ¹ã®å½±ï¼šæš—ã‚ã®ç´« -->
          <ellipse cx="52" cy="72" rx="36" ry="32" fill="#1a0030" opacity="0.4"/>

          <!-- ãŠé‚ªé­”é¢¨èˆ¹ã®æœ¬ä½“ï¼šãƒ€ãƒ¼ã‚¯ç´« -->
          <ellipse cx="50" cy="52" rx="35" ry="45"
            fill="#3d0070" stroke="#1a0030"
            stroke-width="2.5" stroke-linejoin="round"/>

          <!-- æ¯’ã£ã½ã„å…‰æ²¢ï¼ˆç·‘ãŒã‹ã£ãŸç™½ï¼‰ -->
          <ellipse cx="38" cy="34" rx="9" ry="12"
            fill="#b0ff80" opacity="0.25" transform="rotate(-20 38 34)"/>

          <!-- ã‚¬ã‚¤ã‚³ãƒ„é¢¨ã®ç›®ï¼ˆå·¦ï¼‰ -->
          <circle cx="40" cy="48" r="6" fill="#1a0030" opacity="0.85"/>
          <circle cx="40" cy="48" r="3" fill="#ff4444" opacity="0.9"/>

          <!-- ã‚¬ã‚¤ã‚³ãƒ„é¢¨ã®ç›®ï¼ˆå³ï¼‰ -->
          <circle cx="60" cy="48" r="6" fill="#1a0030" opacity="0.85"/>
          <circle cx="60" cy="48" r="3" fill="#ff4444" opacity="0.9"/>

          <!-- ãƒ‹ãƒ¤ãƒªã¨ã—ãŸå£ -->
          <path d="M 36 62 Q 50 75 64 62"
            fill="none" stroke="#1a0030" stroke-width="3"
            stroke-linecap="round" opacity="0.9"/>

          <!-- å£ã®ä¸­ã®ç‰™ï¼ˆã“ã‚ã„æ„Ÿã˜ï¼‰ -->
          <polygon points="43,63 46,71 49,63" fill="white" opacity="0.7"/>
          <polygon points="51,63 54,71 57,63" fill="white" opacity="0.7"/>

          <!-- é¢¨èˆ¹ã®å£ -->
          <polygon points="50,95 44,104 56,104" fill="#1a0030" opacity="0.8"/>

          <!-- ã‚®ã‚¶ã‚®ã‚¶ã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ï¼ˆã‚ã‚‹ã‚‚ã®æ„Ÿï¼‰ -->
          <ellipse cx="50" cy="52" rx="35" ry="45"
            fill="none" stroke="#9b00ff"
            stroke-width="2" stroke-dasharray="6,3" opacity="0.6"/>
        </svg>`;
        }

        /**
         * =====================================================
         * ç‰¹åˆ¥ãªé«˜å¾—ç‚¹é¢¨èˆ¹ï¼ˆãƒ¬ã‚¢é¢¨èˆ¹ï¼‰ã® SVG ã‚’è¿”ã™
         * =====================================================
         * ã‚´ãƒ¼ãƒ«ãƒ‰ï¼‹æ˜Ÿãƒãƒ¼ã‚¯ã§ã€Œå½“ãŸã‚Šï¼ã€æ„Ÿã‚’è¡¨ç¾ã™ã‚‹
         * ã‚­ãƒ©ã‚­ãƒ©ã—ãŸãƒ‡ã‚¶ã‚¤ãƒ³ã«ã—ã¦ä¸€ç›®ã§åˆ†ã‹ã‚‹ã‚ˆã†ã«ã™ã‚‹
         */
        function createSpecialBalloonSVG(size) {
            const w = size;
            const h = size * 1.25;
            return `
        <svg width="${w}" height="${h}" viewBox="0 0 100 125" xmlns="http://www.w3.org/2000/svg">
          <!-- ãƒ¬ã‚¢é¢¨èˆ¹ã®å½±ï¼šã‚´ãƒ¼ãƒ«ãƒ‰ç³» -->
          <ellipse cx="52" cy="72" rx="36" ry="32" fill="#b8860b" opacity="0.35"/>

          <!-- æœ¬ä½“ï¼šé®®ã‚„ã‹ãªã‚´ãƒ¼ãƒ«ãƒ‰ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é¢¨ï¼ˆSVGã¯ã‚°ãƒ©ãƒ‡å®šç¾©ãŒå¿…è¦ï¼‰ -->
          <defs>
            <radialGradient id="goldGrad" cx="40%" cy="35%" r="60%">
              <stop offset="0%"   stop-color="#fffbe6"/>
              <stop offset="50%"  stop-color="#ffd700"/>
              <stop offset="100%" stop-color="#b8860b"/>
            </radialGradient>
          </defs>
          <ellipse cx="50" cy="52" rx="35" ry="45"
            fill="url(#goldGrad)" stroke="#b8860b"
            stroke-width="2.5" stroke-linejoin="round"/>

          <!-- ä¸­å¤®ã«å…‰ã‚‹æ˜Ÿãƒãƒ¼ã‚¯ -->
          <!-- SVGã®pathã§5è§’æ˜Ÿã‚’æã -->
          <polygon
            points="50,22 54,36 68,36 57,45 61,59 50,50 39,59 43,45 32,36 46,36"
            fill="white" opacity="0.9"/>

          <!-- æ˜Ÿã®è¼ãï¼ˆå°ã•ã„4è§’æ˜Ÿã‚’æ•£ã‚‰ã™ï¼‰ -->
          <polygon points="22,20 24,26 30,26 25,30 27,36 22,32 17,36 19,30 14,26 20,26"
            fill="#fff" opacity="0.6" transform="scale(0.55) translate(18,10)"/>
          <polygon points="22,20 24,26 30,26 25,30 27,36 22,32 17,36 19,30 14,26 20,26"
            fill="#fff" opacity="0.5" transform="scale(0.45) translate(130,30)"/>

          <!-- é¢¨èˆ¹ã®å£ -->
          <polygon points="50,95 44,104 56,104" fill="#b8860b" opacity="0.9"/>

          <!-- ã‚­ãƒ©ã‚­ãƒ©ã®ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ -->
          <ellipse cx="50" cy="52" rx="35" ry="45"
            fill="none" stroke="#fff"
            stroke-width="1.5" stroke-dasharray="3,4" opacity="0.7"/>
        </svg>`;
        }

        /**
         * =====================================================
         * å¤§å¤–ã‚Œãƒãƒƒãƒ‰é¢¨èˆ¹ã® SVG
         * =====================================================
         * é®®è¡€è‰²âœ•ã‚ªãƒ¬ãƒ³ã‚¸ã®ãƒã‚¶ãƒ¼ãƒ‰ã‚¹ãƒˆãƒ©ã‚¤ãƒ— + ã‚¬ã‚¤ã‚³ãƒ„ãƒãƒ¼ã‚¯ã§
         * ã€Œã“ã‚Œã¯å°ç‹ã˜ã‚ƒãªã„ï¼ã€ã¨ç›´æ„Ÿã§åˆ†ã‹ã‚‹ãƒ‡ã‚¶ã‚¤ãƒ³
         */
        /**
         * å¤§å¤–ã‚Œãƒãƒƒãƒ‰é¢¨èˆ¹ã® SVG â€” ã‚¦ã‚£ãƒ«ã‚¹ãƒ‡ã‚¶ã‚¤ãƒ³
         * çƒä½“ã«æ”¾å°„çŠ¶ã®ã‚¹ãƒ‘ã‚¤ã‚¯ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã‚’å–ã‚Šå·§ã‘
         * CSS ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¯ãƒ«ã‚¯ãƒ«å›è»¢ã™ã‚‹
         */
        function createSuperBadBalloonSVG(size) {
            const w = size;
            const h = size * 1.25;
            return `
        <svg width="${w}" height="${h}" viewBox="0 0 100 125" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <radialGradient id="superBadGrad" cx="40%" cy="35%" r="65%">
              <stop offset="0%"   stop-color="#ffcc00"/>
              <stop offset="40%"  stop-color="#ff4400"/>
              <stop offset="100%" stop-color="#880000"/>
            </radialGradient>
          </defs>

          <!-- æœ¬ä½“å½± -->
          <ellipse cx="52" cy="72" rx="36" ry="32" fill="#440000" opacity="0.4"/>
          <!-- æœ¬ä½“ï¼šèµ¤ã‚ªãƒ¬ãƒ³ã‚¸ã®å¤§å¤–ã‚Œé¢¨èˆ¹ -->
          <ellipse cx="50" cy="52" rx="35" ry="45"
            fill="url(#superBadGrad)" stroke="#440000"
            stroke-width="2.5"/>

          <!-- ãƒã‚¶ãƒ¼ãƒ‰ã‚¹ãƒˆãƒ©ã‚¤ãƒ— -->
          <ellipse cx="50" cy="52" rx="35" ry="45"
            fill="none" stroke="#000"
            stroke-width="6" stroke-dasharray="9,9" opacity="0.35"/>

          <!-- ç›®ï¼šã‚¬ã‚¤ã‚³ãƒ„ X -->
          <line x1="36" y1="43" x2="44" y2="51" stroke="white" stroke-width="3.5" stroke-linecap="round"/>
          <line x1="44" y1="43" x2="36" y2="51" stroke="white" stroke-width="3.5" stroke-linecap="round"/>
          <line x1="56" y1="43" x2="64" y2="51" stroke="white" stroke-width="3.5" stroke-linecap="round"/>
          <line x1="64" y1="43" x2="56" y2="51" stroke="white" stroke-width="3.5" stroke-linecap="round"/>

          <!-- å£ -->
          <path d="M 34 63 Q 50 72 66 63"
            fill="none" stroke="white" stroke-width="3"
            stroke-linecap="round" opacity="0.9"/>

          <!-- æ­¯ -->
          <polygon points="43,64 46,72 49,64" fill="white" opacity="0.85"/>
          <polygon points="51,64 54,72 57,64" fill="white" opacity="0.85"/>

          <!-- é¢¨èˆ¹ã®å£ -->
          <polygon points="50,95 44,104 56,104" fill="#440000" opacity="0.9"/>

          <!-- è­¦å‘Šè‰²ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ -->
          <ellipse cx="50" cy="52" rx="35" ry="45"
            fill="none" stroke="#ffcc00"
            stroke-width="2" stroke-dasharray="5,3" opacity="0.8"/>
        </svg>`;
        }

        /**
         * =====================================================
         * æ¿€ãƒ¬ã‚¢å¤§é€†è»¢ã‚¢ã‚¤ãƒ†ãƒ ã® SVG
         * =====================================================
         * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰æä¾›ã•ã‚ŒãŸå†™çœŸã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
         */
        function createSuperRareSVG(size) {
            const w = size;
            const h = size * 1.25;
            return `
        <svg width="${w}" height="${h}" viewBox="0 0 100 125" xmlns="http://www.w3.org/2000/svg">
          <!-- å½± -->
          <ellipse cx="50" cy="115" rx="30" ry="8" fill="#000" opacity="0.3"/>

          <!-- å†™çœŸã‚’ä¸¸ãåˆ‡ã‚ŠæŠœããŸã‚ã®ã‚¯ãƒªãƒƒãƒ—ãƒ‘ã‚¹ -->
          <defs>
            <clipPath id="circleClip">
              <circle cx="50" cy="50" r="48" />
            </clipPath>
          </defs>
          
          <!-- å†™çœŸ -->
          <image href="super_rare_face.jpg" x="2" y="2" width="96" height="96" 
            clip-path="url(#circleClip)" preserveAspectRatio="xMidYMid slice" />

          <!-- æ ç·šï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰ -->
          <circle cx="50" cy="50" r="48" fill="none" stroke="#FFD700" stroke-width="2" />

          <!-- ç´ -->
          <line x1="50" y1="98" x2="50" y2="120" stroke="#555" stroke-width="2"/>
        </svg>`;
        }

        // =====================================================
        // â‘§ é¢¨èˆ¹ã®ç”Ÿæˆ
        //    ä¸€å®šé–“éš”ã§å‘¼ã°ã‚Œã€é€šå¸¸ / ã‚ã‚‹ã„ / ãƒ¬ã‚¢é¢¨èˆ¹ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å‡ºã™
        // =====================================================

        /**
         * é¢¨èˆ¹ã‚’1ã¤ç”Ÿæˆã—ã¦ç”»é¢ã«è¿½åŠ ã™ã‚‹
         * ä¹±æ•°ã®ç¯„å›²ã§3ç¨®é¡ã«æŒ¯ã‚Šåˆ†ã‘ã‚‹ï¼š
         *   0.00 ã€œ 0.08 â†’ ãƒ¬ã‚¢é¢¨èˆ¹ï¼ˆ8%ï¼‰
         *   0.08 ã€œ 0.28 â†’ ã‚ã‚‹ã„é¢¨èˆ¹ï¼ˆ20%ï¼‰
         *   0.28 ã€œ 1.00 â†’ é€šå¸¸é¢¨èˆ¹ï¼ˆ72%ï¼‰
         */
        function spawnBalloon() {
            // ---- é¢¨èˆ¹ã®ç¨®é¡ã‚’ä¹±æ•°ã§æ±ºã‚ã‚‹ ----
            const roll = Math.random(); // 0ã€œ1 ã®ä¹±æ•°ã‚’1å›ã ã‘å¼•ã

            // ãƒ•ã‚£ãƒ¼ãƒãƒ¼å‰ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä¸­ï¼ˆtimeLeftãŒ10ã€œ15ç§’ã®é–“ï¼‰ã‹ã©ã†ã‹åˆ¤å®š
            const cdSec = FEVER_START_SEC + FEVER_COUNTDOWN_SEC; // 15
            const isCountdown = typeof feverActive !== 'undefined' && !feverActive && typeof timeLeft !== 'undefined' && timeLeft <= cdSec && timeLeft > FEVER_START_SEC;

            let isSuperBad = false;
            let isSpecial = false;
            let isBad = false;
            let isSuperRare = false;

            // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ã§ã€ã‹ã¤ã“ã®ã‚²ãƒ¼ãƒ ã§ã¾ã 1å›ã‚‚å‡ºç¾ã—ã¦ã„ãªã„å ´åˆ
            // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ç¶™ç¶šæ™‚é–“ãŒé•·ã„ã»ã©ã€ã»ã‚“ã®å°‘ã—ãšã¤å‡ºç¾ç¢ºç‡(0.02%/ç§’)ãŒãƒ—ãƒ©ã‚¹ã•ã‚Œã‚‹
            if (feverActive && !superRareSpawned && typeof SUPER_RARE_CHANCE !== 'undefined') {
                const currentChance = SUPER_RARE_CHANCE + (feverTimeElapsed * 0.0002);
                if (roll < currentChance) {
                    isSuperRare = true;
                    superRareSpawned = true; // å‡ºç¾æ¸ˆã¿ã«ã™ã‚‹
                }
            }

            // ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¬ã‚¢ã˜ã‚ƒãªã„å ´åˆã®ã¿é€šå¸¸ã®åˆ¤å®šã‚’è¡Œã†
            if (!isSuperRare) {
                // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä¸­ä»¥å¤–ã¯é€šå¸¸é€šã‚Šåˆ¤å®š
                if (!isCountdown) {
                    // ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ¬ã‚¢ã®ç¢ºç‡ã¯éå¸¸ã«å°ã•ã„ãŸã‚ã€ä¹±æ•°ã®é–¾å€¤ã‚’èª¿æ•´ã—ãªãã¦ã‚‚ã»ã¼å½±éŸ¿ãªã—
                    isSuperBad = roll < SUPER_BAD_CHANCE;                                                  // å¤§å¤–ã‚Œ 4%
                    isSpecial = !isSuperBad && roll < SUPER_BAD_CHANCE + SPECIAL_BALLOON_CHANCE;          // ãƒ¬ã‚¢é‡‘ 8%
                    isBad = !isSuperBad && !isSpecial &&
                        roll < SUPER_BAD_CHANCE + SPECIAL_BALLOON_CHANCE + BAD_BALLOON_CHANCE;    // ã‚ã‚‹ã„ 20%
                } else {
                    // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ä¸­ã¯ã€å¤§å¤–ã‚Œãƒ»ãƒ¬ã‚¢ã¯å‡ºãšã€ä»£ã‚ã‚Šã«ã€Œã‚ã‚‹ã„é¢¨èˆ¹ã€ã‹ã€Œé€šå¸¸é¢¨èˆ¹ã€ã«ãªã‚‹
                    isBad = roll < BAD_BALLOON_CHANCE;
                }
            }

            // ---- é¢¨èˆ¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºã‚ã‚‹ ----
            // ã‚¹ãƒãƒ›å¯¾å¿œï¼šç”»é¢å¹…ã® 1/4 ã€œ 1/3 ç¨‹åº¦ã«åã¾ã‚‹ã‚ˆã†ã«å‹•çš„ã«è¨ˆç®—ã€‚PCå‘ã‘ã«ä¸Šé™ã¯æ—¢å­˜ã‚µã‚¤ã‚ºã‚’é©ç”¨ã€‚
            const dynamicMin = window.innerWidth * 0.25;
            const dynamicMax = window.innerWidth * 0.33;
            const rMin = Math.min(BALLOON_MIN_SIZE, dynamicMin);
            const rMax = Math.min(BALLOON_MAX_SIZE, dynamicMax);

            // æ¥µç«¯ã«å°ã•ããªã‚Šã™ããªã„ã‚ˆã†ä¸‹é™ã‚‚è¨­å®š (ä¾‹: 50px)
            const finalMin = Math.max(50, rMin);
            const finalMax = Math.max(50, Math.max(finalMin, rMax));

            let size = randomBetween(finalMin, finalMax);

            // æ¿€ãƒ¬ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚µã‚¤ã‚ºã‚’ã•ã‚‰ã«å°ã•ã‚ã«ã™ã‚‹ï¼ˆå…ƒã®ç´„40%ã®ã‚µã‚¤ã‚ºï¼‰
            if (isSuperRare) {
                size *= 0.4;
            }

            // æºã‚Œå¹… (SWAY_AMOUNT) ã‚’è€ƒæ…®ã—ã¦ã€ç”»é¢ã®ç«¯ã‹ã‚‰ç¢ºå®Ÿã«ã¯ã¿å‡ºãªã„ã‚ˆã†ã«ç™ºç”ŸXåº§æ¨™ã‚’åˆ¶é™ã™ã‚‹
            const margin = (size / 2) + SWAY_AMOUNT;
            // ç”»é¢å¹…ãŒæ¥µç«¯ã«ç‹­ã„å ´åˆã®ãƒ•ã‚§ãƒ¼ãƒ«ã‚»ãƒ¼ãƒ•
            const safeMargin = Math.min(margin, window.innerWidth / 3);
            const x = randomBetween(safeMargin, window.innerWidth - safeMargin);

            const y = window.innerHeight + size + 60;
            const speed = randomBetween(BALLOON_SPEED_MIN, BALLOON_SPEED_MAX)
                * (feverActive ? FEVER_SPEED_MULT : 1); // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ã¯é«˜é€ŸåŒ–
            const swayOffset = Math.random() * Math.PI * 2;

            // ---- DOM è¦ç´ ã‚’ä½œã‚‹ ----
            const el = document.createElement('div');
            // ç¨®é¡ã«å¿œã˜ã¦ã‚¯ãƒ©ã‚¹ã‚’ä»˜ã‘ã‚‹ï¼ˆCSSã§è¦‹ãŸç›®ã‚’å¤‰ãˆã‚‹ãŸã‚ï¼‰
            if (isSuperRare) {
                el.className = 'balloon super-rare';
            } else if (isSuperBad) {
                el.className = 'balloon super-bad';
            } else if (isSpecial) {
                el.className = 'balloon special';
            } else if (isBad) {
                el.className = 'balloon bad';
            } else {
                el.className = 'balloon';
            }
            el.style.width = size + 'px';
            el.style.left = x + 'px';
            el.style.top = y + 'px';

            // SVG ã‚’ç¨®é¡ã«å¿œã˜ã¦åˆ‡ã‚Šæ›¿ãˆã‚‹
            if (isSuperRare) {
                el.innerHTML = createSuperRareSVG(size);
            } else if (isSuperBad) {
                el.innerHTML = createSuperBadBalloonSVG(size);
            } else if (isSpecial) {
                el.innerHTML = createSpecialBalloonSVG(size);
            } else if (isBad) {
                el.innerHTML = createBadBalloonSVG(size);
            } else {
                const color = BALLOON_COLORS[Math.floor(Math.random() * BALLOON_COLORS.length)];
                el.innerHTML = createBalloonSVG(color, size);
            }

            // ç´ã‚’è¿½åŠ 
            const string = document.createElement('div');
            string.className = 'string';
            el.appendChild(string);

            // ---- ã‚¯ãƒªãƒƒã‚¯ï¼ˆã‚¿ãƒƒãƒ—ï¼‰ã‚¤ãƒ™ãƒ³ãƒˆ ----
            el.addEventListener('pointerdown', (e) => {
                e.preventDefault(); // â†â˜…è¿½åŠ ï¼šãƒ–ãƒ©ã‚¦ã‚¶ã®ä½™è¨ˆãªæŒ™å‹•ï¼ˆã‚ºãƒ¼ãƒ ç­‰ï¼‰ã‚’å®Œå…¨ã«ç¦æ­¢ï¼
                e.stopPropagation();
                // ç¨®é¡ãƒ•ãƒ©ã‚°ã‚’æ¸¡ã—ã¦ã€ãã‚Œãã‚Œã®å‡¦ç†ã‚’åˆ†ã‘ã‚‹
                popBalloon(balloonData, el, e.clientX, e.clientY, isBad, isSpecial, isSuperBad, isSuperRare);
            });

            // ---- é¢¨èˆ¹ãƒ‡ãƒ¼ã‚¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ ----
            const balloonData = {
                el, x, y, size, speed, swayOffset,
                isBad,      // ãŠé‚ªé­”ã‚­ãƒ£ãƒ©ã‹ã©ã†ã‹
                isSpecial,  // ãƒ¬ã‚¢é«˜å¾—ç‚¹é¢¨èˆ¹ã‹ã©ã†ã‹
                isSuperBad, // å¤§å¤–ã‚Œãƒãƒƒãƒ‰é¢¨èˆ¹ã‹ã©ã†ã‹
                isSuperRare, // æ¿€ãƒ¬ã‚¢å¤§é€†è»¢ã‚¢ã‚¤ãƒ†ãƒ ã‹ã©ã†ã‹
                popped: false
            };

            balloons.push(balloonData);
            document.body.appendChild(el);
        }

        // =====================================================
        // â‘¨ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ï¼ˆæ¯ãƒ•ãƒ¬ãƒ¼ãƒ å®Ÿè¡Œï¼‰
        // =====================================================

        /** ã™ã¹ã¦ã®é¢¨èˆ¹ã‚’æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å‹•ã‹ã™ */
        function gameLoop() {
            frame++;
            const liveBalloons = [];

            for (const b of balloons) {
                if (b.popped) continue;

                // ä¸Šã«ç§»å‹•
                b.y -= b.speed;

                // å·¦å³ã«ãµã‚ãµã‚æºã‚‰ã™ï¼ˆã‚µã‚¤ãƒ³æ³¢ï¼‰
                const sway = Math.sin(frame * SWAY_SPEED + b.swayOffset) * SWAY_AMOUNT;
                b.el.style.top = b.y + 'px';
                b.el.style.left = (b.x + sway) + 'px';

                // ç”»é¢ä¸Šç«¯ã‚’è¶…ãˆãŸã‚‰å‰Šé™¤
                if (b.y < -(b.size + 80)) {
                    b.el.remove();
                } else {
                    liveBalloons.push(b);
                }
            }

            balloons = liveBalloons;
            animationId = requestAnimationFrame(gameLoop);
        }

        // =====================================================
        // â‘© é¢¨èˆ¹ã‚’å‰²ã‚‹å‡¦ç†
        // =====================================================

        /**
         * é¢¨èˆ¹ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã¨ãã®å‡¦ç†
         * @param {object}  balloonData - é¢¨èˆ¹ã®ãƒ‡ãƒ¼ã‚¿
         * @param {HTMLElement} el      - é¢¨èˆ¹ã® DOM è¦ç´ 
         * @param {number}  cx, cy      - ã‚¯ãƒªãƒƒã‚¯åº§æ¨™
         * @param {boolean} isBad       - ãŠé‚ªé­”é¢¨èˆ¹ã‹ã©ã†ã‹
         */
        function popBalloon(balloonData, el, cx, cy, isBad, isSpecial, isSuperBad, isSuperRare) {
            if (balloonData.popped) return;
            balloonData.popped = true;
            el.remove();

            if (isSuperRare) {
                // =====================================================
                // æ¿€ãƒ¬ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰²ã£ãŸã¨ãã®å‡¦ç†ï¼ˆç›®ç«‹ãŸãªã„ã‚ˆã†ã«å¤‰æ›´ï¼‰
                // =====================================================
                playFanfareSound();

                // æ–°ã—ã„ã‚·ãƒ¥ãƒ¼ãƒ«ãªæ¼”å‡ºï¼šæä¾›ã•ã‚ŒãŸç”»åƒãŒåŠ å·¥ã•ã‚Œãšã«ãã®ã¾ã¾å‡ºã¦ãã¦ã€ã‚¹ã‚¹ã‚¹ãƒ¼ã£ã¨æ¶ˆãˆã¦ã„ã
                const surrealImg = document.createElement('img');
                surrealImg.src = 'super_rare_pop.jpg';
                surrealImg.className = 'surreal-pop';
                surrealImg.style.left = cx + 'px';
                surrealImg.style.top = cy + 'px';

                // ç”»åƒã‚’å…ƒã®é¢¨èˆ¹ï¼ˆç´ã‚’å«ã‚€ï¼‰ç¨‹åº¦ã®ã‚µã‚¤ã‚ºã«ç¸®å°
                const h = balloonData.size * 1.25;
                surrealImg.style.height = h + 'px';
                surrealImg.style.width = 'auto'; // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ç¶­æŒ

                document.body.appendChild(surrealImg);
                setTimeout(() => surrealImg.remove(), 2000); // 2ç§’å¾Œã«å‰Šé™¤ã™ã‚‹

                // è¶…é«˜å¾—ç‚¹ã‚’åŠ ç®—ï¼ˆ+3000ptsï¼‰â€»ç‰¹åˆ¥ãªå·¨å¤§ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯ç„¡åŠ¹åŒ–ï¼ˆç¬¬6å¼•æ•°=falseï¼‰ã—ã¦ãƒ¬ã‚¢é‡‘é¢¨èˆ¹æ‰±ã„ã®è¡¨ç¤ºã«ã™ã‚‹
                addScore(SUPER_RARE_POINTS, cx, cy, false, true, false);

            } else if (isSuperBad) {
                // =====================================================
                // å¤§å¤–ã‚Œãƒãƒƒãƒ‰é¢¨èˆ¹ã‚’å‰²ã£ãŸã¨ãã®å‡¦ç†
                // =====================================================

                // é•·ã‚ã®ã‚¢ãƒ©ãƒ¼ãƒ éŸ³ã‚’é³´ã‚‰ã™
                playSuperBadAlarm();

                // ç”»é¢ã‚’äºŒåº¦èµ¤ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ï¼ˆãƒšãƒŠãƒ«ãƒ†ã‚£ã®å¤§ãã•ã‚’å¼·èª¿ï¼‰
                showRedFlash();
                setTimeout(() => showRedFlash(), 180);

                // ã€ŒDANGER!ã€ãƒ†ã‚­ã‚¹ãƒˆ
                const superBadText = document.createElement('div');
                superBadText.className = 'float-label bad-text';
                superBadText.textContent = 'â˜ ï¸ DANGER!';
                superBadText.style.cssText = `left:${cx - 55}px; top:${cy - 55}px;
                    font-size:2rem; color:#ff2200;`;
                document.body.appendChild(superBadText);
                setTimeout(() => superBadText.remove(), 1000);

                // ã‚¹ã‚³ã‚¢ã‚’å¤§å¹…æ¸›ç‚¹ï¼ˆ-50ç‚¹ï¼‰
                addScore(-SUPER_BAD_PENALTY, cx, cy, true);

                // == æ–°æ©Ÿèƒ½: å¤§å¤–ã‚Œé¢¨èˆ¹ã¯-2ç§’ï¼ˆãƒãƒ©ãƒ³ã‚¹ç”¨ãƒªã‚¹ã‚¯ï¼‰ ==
                // ç†ç”±ï¼šãƒ¬ã‚¢ã¯å‡ºç¾ç‡8%ã§+1ç§’ã€å¤§å¤–ã‚Œã¯å‡ºç¾ç‡4%ã§-2ç§’ã€‚
                // æœŸå¾…å€¤ã¯ãƒ—ãƒ©ãƒã‚¤ã‚¼ãƒ­ã«ãªã‚‹ãŸã‚ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è…•æ¬¡ç¬¬ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹ã‹ç”Ÿãæ®‹ã‚‹ã‹ãŒæ±ºã¾ã‚‹ã€‚
                timeLeft -= 2;
                if (timeLeft < 0) timeLeft = 0; // 0ç§’æœªæº€ã«ã¯ãªã‚‰ãªã„
                document.getElementById('timerValue').textContent = String(timeLeft).padStart(2, '0');

                // æ™‚é–“æ¸›å°‘ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
                const timeEl = document.createElement('div');
                timeEl.className = 'float-label time-sub';
                timeEl.textContent = '-2ç§’';
                timeEl.style.left = (cx + 25) + 'px';
                timeEl.style.top = (cy - 20) + 'px';
                document.body.appendChild(timeEl);
                setTimeout(() => timeEl.remove(), 1000);

                // ã‚‚ã—æ™‚é–“ãŒä¸€æ°—ã«5ç§’ä»¥ä¸‹ã«ãªã£ãŸã‚‰è­¦å‘Š(danger)ã‚’ä»˜ã‘ã‚‹
                if (timeLeft <= 5) {
                    document.getElementById('timerBoard').classList.add('danger');
                }

                if (timeLeft === 0) {
                    endGame(); // ãƒšãƒŠãƒ«ãƒ†ã‚£ã§0ç§’ã«ãªã£ãŸã‚‰å³çµ‚äº†
                }

            } else if (isSpecial) {
                // =====================================================
                // ãƒ¬ã‚¢é«˜å¾—ç‚¹é¢¨èˆ¹ã‚’å‰²ã£ãŸã¨ãã®å‡¦ç†
                // =====================================================
                playFanfareSound();
                showGoldFlash();
                const specialText = document.createElement('div');
                specialText.className = 'float-label special-text';
                specialText.textContent = 'â­ ã‚„ã£ãŸãƒ¼ï¼';
                specialText.style.left = (cx - 55) + 'px';
                specialText.style.top = (cy - 50) + 'px';
                document.body.appendChild(specialText);
                setTimeout(() => specialText.remove(), 1000);
                showSpecialPopEffect(cx, cy, balloonData.size);
                addScore(SPECIAL_BALLOON_POINTS, cx, cy, false, true);

                // == æ–°æ©Ÿèƒ½: ãƒ¬ã‚¢é¢¨èˆ¹ã¯+1ç§’ï¼ˆçµ¶å¦™ãªãƒãƒ©ãƒ³ã‚¹èª¿æ•´ï¼‰ ==
                // ç†ç”±ï¼šãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ã¯æ¯ç§’ç´„1åŒ¹ã®ãƒ¬ã‚¢ãŒå‡ºç¾ã€‚å®Œç’§ãªãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã‚‰ç„¡é™ã«éŠã¹ã‚‹ãŒã€
                // å®Ÿéš›ã¯ã‚¹ãƒãƒ›ã§å°‘ã—è¦‹é€ƒã™ãŸã‚ã€+1ç§’ãªã‚‰å¾ã€…ã«æ¸›ã‚Šã€ç™½ç†±ã—ãŸç´„50ç§’é–“ã®å»¶é•·ãƒ•ã‚£ãƒ¼ãƒãƒ¼ã«ãªã‚‹ã€‚
                timeLeft += 1; // 1ç§’å»¶é•·
                document.getElementById('timerValue').textContent = String(timeLeft).padStart(2, '0');

                // æ™‚é–“å»¶é•·ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
                const timeEl = document.createElement('div');
                timeEl.className = 'float-label time-add';
                timeEl.textContent = '+1ç§’';
                timeEl.style.left = (cx + 25) + 'px'; // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã¨å°‘ã—æ¨ªã«ãšã‚‰ã™
                timeEl.style.top = (cy - 20) + 'px'; // å°‘ã—ä¸‹ã«è¡¨ç¤ºã—ã¦è¢«ã‚Šã‚’å›é¿
                document.body.appendChild(timeEl);
                setTimeout(() => timeEl.remove(), 1000);

                // ã‚‚ã—æ™‚é–“ãŒ5ç§’ã‚’è¶…ãˆãŸã‚‰è­¦å‘Š(danger)ã‚’å¤–ã™
                if (timeLeft > 5) {
                    document.getElementById('timerBoard').classList.remove('danger');
                }

            } else if (isBad) {
                // =====================================================
                // ãŠé‚ªé­”é¢¨èˆ¹ï¼ˆã‚ã‚‹ã„é¢¨èˆ¹ï¼‰ã‚’å‰²ã£ã¦ã—ã¾ã£ãŸå ´åˆ
                // =====================================================
                playBuzzerSound();
                showRedFlash();
                const badText = document.createElement('div');
                badText.className = 'float-label bad-text';
                badText.textContent = 'ğŸ’€ ãƒ€ãƒ¡ï¼';
                badText.style.left = (cx - 40) + 'px';
                badText.style.top = (cy - 40) + 'px';
                document.body.appendChild(badText);
                setTimeout(() => badText.remove(), 900);
                addScore(-BAD_BALLOON_PENALTY, cx, cy, true);

            } else {
                // é€šå¸¸ã®é¢¨èˆ¹ã®å ´åˆ
                playPopSound();
                showPopEffect(cx, cy, balloonData.size);
                // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ã¯é€šå¸¸é¢¨èˆ¹ã®ã‚¹ã‚³ã‚¢ã‚’ FEVER_SCORE_MULT å€ã«ã™ã‚‹
                const normalPts = 50 * (feverActive ? FEVER_SCORE_MULT : 1);
                addScore(normalPts, cx, cy, false);
            }
        }

        /**
         * ç”»é¢ã‚’ä¸€ç¬èµ¤ãã—ã¦ã€ãƒšãƒŠãƒ«ãƒ†ã‚£ã‚’è¦–è¦šã§ä¼ãˆã‚‹
         * ã‚ã‚‹ã„é¢¨èˆ¹ã‚’å‰²ã£ãŸã¨ãã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥æ¼”å‡º
         */
        function showRedFlash() {
            // èµ¤ã„åŠé€æ˜ã® div ã‚’å…¨ä½“ã«é‡ã­ã‚‹
            const flash = document.createElement('div');
            flash.style.cssText = `
        position: fixed; inset: 0; z-index: 150;
        background: rgba(220, 0, 0, 0.3);
        pointer-events: none;
        animation: flashOut 0.4s ease-out forwards;
      `;
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 400);
        }

        /**
         * =====================================================
         * ãƒ¬ã‚¢é¢¨èˆ¹ã‚’å‰²ã£ãŸã¨ãã®ã‚´ãƒ¼ãƒ«ãƒ‰ãƒ•ãƒ©ãƒƒã‚·ãƒ¥æ¼”å‡º
         * =====================================================
         * ç”»é¢ã‚’ä¸€ç¬ãã‚‰ãã‚‰é‡‘è‰²ã«ã—ã¦ã€Œå½“ãŸã‚Šï¼ã€æ„Ÿã‚’é«˜ã‚ã‚‹
         */
        function showGoldFlash() {
            const flash = document.createElement('div');
            flash.style.cssText = `
                position: fixed; inset: 0; z-index: 150;
                background: rgba(255, 215, 0, 0.35);
                pointer-events: none;
                animation: flashOut 0.5s ease-out forwards;
            `;
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 500);
        }

        /**
         * =====================================================
         * æ¿€ãƒ¬ã‚¢å¤§é€†è»¢ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰²ã£ãŸã¨ãã®ã‚°ãƒªãƒ¼ãƒ³ãƒ•ãƒ©ãƒƒã‚·ãƒ¥æ¼”å‡º
         * =====================================================
         */
        function showGreenFlash() {
            const flash = document.createElement('div');
            flash.style.cssText = `
                position: fixed; inset: 0; z-index: 150;
                background: rgba(0, 255, 0, 0.4);
                mix-blend-mode: screen;
                pointer-events: none;
                animation: flashOut 0.8s ease-out forwards;
            `;
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 800);
        }

        /**
         * =====================================================
         * æ¿€ãƒ¬ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ã®æ´¾æ‰‹ãªç ´è£‚ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
         * =====================================================
         */
        function showSuperRarePopEffect(x, y, size) {
            const pop = document.createElement('div');
            pop.className = 'pop-effect';
            pop.style.left = (x - size / 2) + 'px';
            pop.style.top = (y - size / 2) + 'px';
            pop.style.width = size + 'px';
            pop.style.height = size + 'px';

            const colors = ['#00FF00', '#80FF80', '#FFFFFF', '#00CC00', '#00FFCC'];
            const sparkCount = 12; // ã•ã‚‰ã«å¤šã

            for (let i = 0; i < sparkCount; i++) {
                const spark = document.createElement('div');
                const angle = (i / sparkCount) * Math.PI * 2 + (Math.random() * 0.5);
                const dist = size * 1.5;
                const sparkColor = colors[i % colors.length];
                const sparkSize = (i % 3 === 0) ? 16 : 8;

                spark.style.cssText = `
                    position:absolute; width:${sparkSize}px; height:${sparkSize}px;
                    background:${sparkColor}; 
                    border-radius: ${i % 2 === 0 ? '50%' : '0'}; /* å››è§’ã„ç ´ç‰‡ã‚‚æ··ãœã‚‹ */
                    left:50%; top:50%;
                    --tx: ${Math.cos(angle) * dist}px;
                    --ty: ${Math.sin(angle) * dist}px;
                    --spark-scale-start: 1.5;
                    transform:translate(-50%,-50%) rotate(${Math.random() * 360}deg);
                    box-shadow: 0 0 10px ${sparkColor};
                    animation:sparkAnim 0.9s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
                `;
                pop.appendChild(spark);
            }
            document.body.appendChild(pop);
            setTimeout(() => pop.remove(), 1000);
        }

        /**
         * =====================================================
         * ãƒ¬ã‚¢é¢¨èˆ¹ã®è±ªè¯ãªé‡‘è‰²ç ´è£‚ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
         * =====================================================
         * é€šå¸¸ã‚ˆã‚Šå¤šãã®é‡‘è‰²ã®æ˜Ÿã‚’é£›ã³æ•£ã‚‰ã›ã‚‹
         */
        function showSpecialPopEffect(x, y, size) {
            const pop = document.createElement('div');
            pop.className = 'pop-effect';
            pop.style.left = (x - size / 2) + 'px';
            pop.style.top = (y - size / 2) + 'px';
            pop.style.width = size + 'px';
            pop.style.height = size + 'px';

            // é‡‘ãƒ»ç™½ãƒ»ã‚ªãƒ¬ãƒ³ã‚¸ä¸­å¿ƒã®è±ªè¯ãªã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ
            const colors = ['#FFD700', '#FFF176', '#FFAB00', '#FFFFFF', '#FFD700', '#FFF9C4'];
            const sparkCount = 6; // ã‚¹ãƒ‘ãƒ¼ã‚¯æ•°ã‚’æ¸›ã‚‰ã—ã¦å‹•çš„ @keyframes ã®ç”Ÿæˆã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‹

            for (let i = 0; i < sparkCount; i++) {
                const spark = document.createElement('div');
                const angle = (i / sparkCount) * Math.PI * 2;
                const dist = size * 1.2; // é€šå¸¸ã‚ˆã‚Šé ãã¾ã§é£›ã¶
                const sparkColor = colors[i % colors.length];
                // æ˜Ÿå½¢ã«è¦‹ãˆã‚‹ã‚ˆã†ã€å¤§ãã•ã‚’äº¤äº’ã«å¤‰ãˆã‚‹
                const sparkSize = i % 2 === 0 ? 12 : 7;
                spark.style.cssText = `
                    position:absolute; width:${sparkSize}px; height:${sparkSize}px;
                    background:${sparkColor}; border-radius:50%;
                    left:50%; top:50%;
                    --tx: ${Math.cos(angle) * dist}px;
                    --ty: ${Math.sin(angle) * dist}px;
                    --spark-scale-start: 1.2;
                    transform:translate(-50%,-50%);
                    box-shadow: 0 0 6px ${sparkColor};
                    animation:sparkAnim 0.7s ease-out forwards;
                `;
                pop.appendChild(spark);
            }
            document.body.appendChild(pop);
            setTimeout(() => pop.remove(), 800);
        }

        /**
         * ç ´è£‚ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆæ˜ŸãŒé£›ã³æ•£ã‚‹ï¼‰ã¨ã€Œãƒãƒ³ï¼ã€ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹
         */
        function showPopEffect(x, y, size) {
            const pop = document.createElement('div');
            pop.className = 'pop-effect';
            pop.style.left = (x - size / 2) + 'px';
            pop.style.top = (y - size / 2) + 'px';
            pop.style.width = size + 'px';
            pop.style.height = size + 'px';

            const colors = ['#FFD700', '#FF4757', '#2ED573', '#1E90FF', '#FF6B35', '#A855F7'];
            const sparkCount = 8;

            for (let i = 0; i < sparkCount; i++) {
                const spark = document.createElement('div');
                const angle = (i / sparkCount) * Math.PI * 2;
                const dist = size * 0.8;
                const sparkColor = colors[i % colors.length];
                spark.style.cssText = `
          position:absolute; width:10px; height:10px;
          background:${sparkColor}; border-radius:50%;
          left:50%; top:50%;
          --tx: ${Math.cos(angle) * dist}px;
          --ty: ${Math.sin(angle) * dist}px;
          --spark-scale-start: 1;
          transform:translate(-50%,-50%);
          animation:sparkAnim 0.5s ease-out forwards;
        `;
                pop.appendChild(spark);
            }
            document.body.appendChild(pop);

            const text = document.createElement('div');
            text.className = 'float-label pop-text';
            text.textContent = 'ãƒãƒ³ï¼';
            text.style.left = (x - 30) + 'px';
            text.style.top = (y - 40) + 'px';
            document.body.appendChild(text);

            setTimeout(() => { pop.remove(); text.remove(); }, 700);
        }

        // =====================================================
        // â‘ª ã‚¹ã‚³ã‚¢ã®åŠ ç®—ãƒ»æ¸›ç®—ã¨è¡¨ç¤º
        // =====================================================

        /**
         * ã‚¹ã‚³ã‚¢ã‚’å¤‰æ›´ã—ã¦è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹
         * @param {number}  points    - å¤‰åŒ–é‡ï¼ˆãƒ—ãƒ©ã‚¹ã§åŠ ç‚¹ã€ãƒã‚¤ãƒŠã‚¹ã§æ¸›ç‚¹ï¼‰
         * @param {number}  x, y      - æ•°å­—ãŒæµ®ã‹ã¶ä½ç½®
         * @param {boolean} isBad     - æ¸›ç‚¹ã®å ´åˆã¯ true
         * @param {boolean} isSpecial - ãƒ¬ã‚¢é¢¨èˆ¹ã®å ´åˆã¯ trueï¼ˆé‡‘è‰²è¡¨ç¤ºï¼‰
         * @param {boolean} isSuperRare - æ¿€ãƒ¬ã‚¢ã‚¢ã‚¤ãƒ†ãƒ ã®å ´åˆã¯ trueï¼ˆç·‘è‰²å·¨å¤§è¡¨ç¤ºï¼‰
         */
        function addScore(points, x, y, isBad, isSpecial, isSuperRare = false) {
            score += points;
            // ã‚¹ã‚³ã‚¢ã‚’5æ¡ï¼ˆä¾‹ï¼š00150ï¼‰ã«ã‚¼ãƒ­åŸ‹ã‚ã™ã‚‹å‡¦ç†ã€‚ãƒã‚¤ãƒŠã‚¹ã®å ´åˆã¯ç¬¦å·ã‚’å«ã‚ã¦æ¡æ•°ã‚’èª¿æ•´
            const displayScore = score >= 0
                ? String(score).padStart(5, '0')
                : '-' + String(Math.abs(score)).padStart(4, '0');
            document.getElementById('scoreValue').textContent = displayScore;

            // åŠ ç‚¹ãƒ»æ¸›ç‚¹ãƒ»ãƒ¬ã‚¢ã§è¦‹ãŸç›®ã‚’å¤‰ãˆã‚‹
            const el = document.createElement('div');
            if (isSuperRare) {
                el.className = 'float-label score-super-rare';
            } else if (isSpecial) {
                el.className = 'float-label score-special';
            } else if (isBad) {
                el.className = 'float-label score-sub';
            } else {
                el.className = 'float-label score-add';
            }
            el.textContent = (points >= 0 ? '+' : '') + points;
            el.style.left = (x - 20) + 'px';
            el.style.top = (y - 10) + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), (isSuperRare ? 1200 : 1000));
        }

        // =====================================================
        // â‘« æ–°æ©Ÿèƒ½â‘  ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒãƒ¼
        // =====================================================

        /**
         * 1ç§’ã”ã¨ã«æ®‹ã‚Šæ™‚é–“ã‚’æ¸›ã‚‰ã—ã€è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹
         * 0ã«ãªã£ãŸã‚‰ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã™ã‚‹
         */
        function startCountdown() {
            timeLeft = GAME_DURATION_SEC;
            feverActive = false;
            document.getElementById('timerValue').textContent = String(timeLeft).padStart(2, '0');
            document.getElementById('timerBoard').classList.remove('danger');

            countdownTimer = setInterval(() => {
                timeLeft--;
                document.getElementById('timerValue').textContent = String(timeLeft).padStart(2, '0');

                // (ã‚¹ãƒãƒ›ã§ã®è² è·è»½æ¸›ã®ãŸã‚ã€JSã§ã®æ¯ç§’ã®èƒŒæ™¯è‰²æ›´æ–°ã¯å»ƒæ­¢ã—ã€CSS transitionã«ä»»ã›ã‚‹)

                // ãƒ•ã‚£ãƒ¼ãƒãƒ¼å‰ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤ºé ˜åŸŸ: FEVER_START_SEC + FEVER_COUNTDOWN_SEC ç§’ â†’ FEVER_START_SEC+1 ç§’
                const cdSec = FEVER_START_SEC + FEVER_COUNTDOWN_SEC; // = 15ç§’
                if (timeLeft <= cdSec && timeLeft > FEVER_START_SEC && !feverActive) {
                    const remaining = timeLeft - FEVER_START_SEC; // 5,4,3,2,1
                    showFeverCountdown(remaining);
                }

                // ãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ãªã‚‰çµŒéæ™‚é–“ã‚’åŠ ç®—ã™ã‚‹ï¼ˆãƒœãƒ¼ãƒŠã‚¹ã‚¢ã‚¤ãƒ†ãƒ ç¢ºç‡ä¸Šæ˜‡ã®ãŸã‚ï¼‰
                if (feverActive) {
                    feverTimeElapsed++;
                }

                // æ®‹ã‚Š10ç§’ã§ãƒ•ã‚£ãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ é–‹å§‹
                if (timeLeft === FEVER_START_SEC && !feverActive) {
                    startFeverTime();
                }

                // æ®‹ã‚Š5ç§’ä»¥ä¸‹ã§ã‚¿ã‚¤ãƒãƒ¼è­¦å‘Š
                if (timeLeft <= 5) {
                    document.getElementById('timerBoard').classList.add('danger');
                } else {
                    document.getElementById('timerBoard').classList.remove('danger');
                }

                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        /**
         * ãƒ•ã‚£ãƒ¼ãƒãƒ¼å‰ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³æ•°å­—ã‚’ç”»é¢ä¸­å¤®ã«è¡¨ç¤º / æ›´æ–°ã™ã‚‹
         * @param {number} n - æ®‹ã‚Šã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ç§’æ•°ï¼ˆ5â†’â†’1ï¼‰
         */
        function showFeverCountdown(n) {
            // æ—¢å­˜è¦ç´ ã¾ãŸã¯æ–°è¦ä½œæˆ
            let cd = document.getElementById('feverCountdown');
            if (!cd) {
                cd = document.createElement('div');
                cd.id = 'feverCountdown';
                document.body.appendChild(cd);
            }
            // æ•°å­—ã‚’å†è¦è¨­ã™ã‚‹ã“ã¨ã§ countPop ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿã™ã‚‹
            cd.innerHTML = `
                <span class="cd-label">ğŸ”¥ FEVER ğŸ”¥<br>âš¡ COMING âš¡</span>
                <span class="cd-number">${n}</span>
            `;
            // animationã®å†èµ·å‹•ã®ãŸã‚ã«ä¸€åº¦ display:none ã‚’æŒ¿ã‚€
            const numEl = cd.querySelector('.cd-number');
            numEl.style.animation = 'none';
            void numEl.offsetWidth; // reflow
            numEl.style.animation = 'countPop 0.25s cubic-bezier(0.22,1,0.36,1) both';
        }

        /**
         * ãƒ•ã‚£ãƒ¼ãƒãƒ¼ã‚¿ã‚¤ãƒ é–‹å§‹ï¼šé¢¨èˆ¹ç”Ÿæˆã‚’æ€¥åŠ é€Ÿã—ã€æ¼”å‡ºã‚’æ·»ãˆã‚‹
         */
        function startFeverTime() {
            feverActive = true;
            feverTimeElapsed = 0;

            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¦ç´ ã‚’å‰Šé™¤
            const cdEl = document.getElementById('feverCountdown');
            if (cdEl) cdEl.remove();

            // ã‚¹ãƒãƒƒãƒ¼ãƒ³é–“éš”ã‚’æ€¥åŠ é€Ÿ
            clearInterval(spawnTimer);
            spawnTimer = setInterval(spawnBalloon, FEVER_INTERVAL_MS);

            // bodyã«.feverã‚¯ãƒ©ã‚¹ã‚’ä»˜ã‘ã¦è‰²å–«ã‚’é–‹å§‹
            document.body.classList.add('fever');

            // èƒŒæ™¯è‰²ã‚’å¤•æš®ã‚Œã€œå¤œç©ºã¸CSSã®transitionã§æ»‘ã‚‰ã‹ã«å¤‰åŒ–ã•ã›ã‚‹ï¼ˆJSã®æ¯ç§’æç”»ã‹ã‚‰å¤‰æ›´ï¼‰
            triggerFeverSky();


            // ã€ŒğŸ‰ FEVER TIME!ã€ãƒãƒŠãƒ¼ã‚’è¡¨ç¤º
            const banner = document.createElement('div');
            banner.id = 'feverBanner';
            banner.innerHTML = '<div class="fever-text">ğŸ‰ FEVER TIME! ğŸ‰</div>';
            document.body.appendChild(banner);

            // ãƒ•ã‚£ãƒ¼ãƒãƒ¼éŸ³
            playFeverJingle();

            // 1.5ç§’å¾Œã«ãƒãƒŠãƒ¼ã‚’ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
            setTimeout(() => {
                banner.style.transition = 'opacity 0.5s';
                banner.style.opacity = '0';
                setTimeout(() => banner.remove(), 500);
            }, 1500);
        }

        /**
         * ãƒ•ã‚£ãƒ¼ãƒãƒ¼é–‹å§‹æ™‚ã®æ±ºå®šçš„ãªã‚¸ãƒ³ã‚°ãƒ«éŸ³
         * ä¸Šã«å‘ã‹ã†ã‚¹ãƒãƒ£ã‚«ãƒãƒƒãƒ†ã‚£ãªéŸ³åˆ—
         */
        /**
         * ãƒ•ã‚£ãƒ¼ãƒãƒ¼ä¸­ã«èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¤•æš®ã‚Œã€œå¤œç©ºã¸å¤‰åŒ–ã•ã›ã‚‹ï¼ˆè² è·è»½æ¸›ç‰ˆï¼‰
         */
        function triggerFeverSky() {
            // JSã®æ¯ç§’æç”»ï¼ˆsetIntervalï¼‰ã§ã¯ãªãã€CSSã®transitionæ©Ÿèƒ½ã§è‡ªç„¶ã«å¤‰åŒ–ã•ã›ã‚‹
            document.body.style.transition = `background-image ${FEVER_START_SEC}s linear`;
            document.body.style.backgroundImage = `linear-gradient(to bottom,
                rgb(30, 10, 60) 0%,
                rgb(140, 40, 80) 45%,
                rgb(220, 90, 40) 100%)`;
        }



        function playFeverJingle() {
            if (!audioCtx) return;
            const notes = [
                { freq: 659, time: 0.00 },
                { freq: 784, time: 0.10 },
                { freq: 988, time: 0.20 },
                { freq: 1319, time: 0.30 },
            ];
            notes.forEach(({ freq, time }) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + time);
                gain.gain.setValueAtTime(0.25, audioCtx.currentTime + time);
                gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + time + 0.18);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(audioCtx.currentTime + time);
                osc.stop(audioCtx.currentTime + time + 0.2);
            });
        }

        // =====================================================
        // â‘¬ æ–°æ©Ÿèƒ½â‘¡ ã‚²ãƒ¼ãƒ çµ‚äº†ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ãƒƒãƒ—ï¼‰å‡¦ç†
        // =====================================================

        /**
         * ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†ã—ã¦çµæœç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹
         * ã‚¿ã‚¤ãƒãƒ¼ãŒ 0 ã«ãªã£ãŸã¨ãã«å‘¼ã°ã‚Œã‚‹
         */
        function endGame() {
            gameRunning = false;

            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚’æ­¢ã‚ã‚‹
            clearInterval(countdownTimer);
            countdownTimer = null;

            // é¢¨èˆ¹ã®ç”Ÿæˆã‚’æ­¢ã‚ã‚‹
            clearInterval(spawnTimer);
            spawnTimer = null;

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ã‚’æ­¢ã‚ã‚‹
            cancelAnimationFrame(animationId);
            animationId = null;

            // ç”»é¢ã«æ®‹ã£ã¦ã„ã‚‹é¢¨èˆ¹ã‚’ã™ã¹ã¦æ¶ˆã™
            balloons.forEach(b => b.el.remove());
            balloons = [];

            // ====== â–¼ ãƒªã‚¶ãƒ«ãƒˆç”»é¢è¡¨ç¤ºå‡¦ç† ====== //

            // æ®‹ã£ã¦ã„ã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆå¤§é€†è»¢ã‚¢ã‚¤ãƒ†ãƒ ã®é¡”ãƒ‰ã‚¢ãƒƒãƒ—ç­‰ï¼‰ã‚’æ¶ˆå»ã™ã‚‹
            const lingeringEffects = document.querySelectorAll('.surreal-pop');
            lingeringEffects.forEach(el => el.remove());

            document.getElementById('resultScore').textContent = `${score} pts`;

            // ã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦å¿œæ´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
            const msg = getResultMessage(score);
            document.getElementById('resultMsg').textContent = msg;

            // ãƒ•ã‚£ãƒ¼ãƒãƒ¼çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            feverActive = false;
            document.body.classList.remove('fever');
            const banner = document.getElementById('feverBanner');
            if (banner) banner.remove();

            // çµæœç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹ï¼ˆéè¡¨ç¤º â†’ è¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆï¼‰
            // æ˜Ÿç©ºã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¦ã‹ã‚‰è¡¨ç¤º
            showStars();
            document.getElementById('resultOverlay').style.display = 'flex';
        }

        /**
         * ã‚¹ã‚³ã‚¢ã«å¿œã˜ãŸçµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™
         * @param {number} finalScore - æœ€çµ‚ã‚¹ã‚³ã‚¢
         * @returns {string} ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ–‡å­—åˆ—
         */
        /**
         * ãƒªã‚¶ãƒ«ãƒˆç”»é¢ã«è¼ãæ˜Ÿã‚’ãƒ©ãƒ³ãƒ€ãƒ é…ç½®ã™ã‚‹
         * CSS ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§ã²ã¨ã¤ã²ã¨ã¤é•ã†ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã¾ãŸãŸã
         */
        function showStars() {
            const overlay = document.getElementById('resultOverlay');
            clearStars();

            for (let i = 0; i < 80; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() < 0.15 ? 3 : Math.random() < 0.5 ? 2 : 1;
                const dur = (1.2 + Math.random() * 2.8).toFixed(2); // 1.2sã€œ4s
                const lo = (0.1 + Math.random() * 0.3).toFixed(2);
                const hi = (0.6 + Math.random() * 0.4).toFixed(2);
                const colors = ['white', 'white', 'white', '#ffe97a', '#aad4ff', '#ffd0f0'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                star.style.cssText = `
                    width:${size}px; height:${size}px;
                    left:${(Math.random() * 100).toFixed(1)}%;
                    top:${(Math.random() * 100).toFixed(1)}%;
                    background:${color};
                    --dur:${dur}s; --lo:${lo}; --hi:${hi};
                    animation-delay:${(Math.random() * 2).toFixed(2)}s;
                `;
                overlay.appendChild(star);
            }
        }

        /** ãƒªã‚¶ãƒ«ãƒˆç”»é¢ã®æ˜Ÿã‚’ã™ã¹ã¦å‰Šé™¤ã™ã‚‹ï¼ˆãƒªãƒˆãƒ©ã‚¤æ™‚ï¼‰ */
        function clearStars() {
            document.querySelectorAll('#resultOverlay .star').forEach(s => s.remove());
        }

        function getResultMessage(finalScore) {
            if (finalScore >= 16000) return 'ğŸ… GOD â€” ä¼èª¬ã®ãƒãƒ«ãƒ¼ãƒ³ãƒãƒ³ã‚¿ãƒ¼';
            if (finalScore >= 12000) return 'ğŸ‘‘ PERFECT â€” ç¥ãŒã‹ã£ãŸãƒ—ãƒ¬ã‚¤';
            if (finalScore >= 8000) return 'ğŸ”¥ EXCELLENT â€” é¬¼ç¥ã®å¦‚ãé€£æ‰“åŠ›';
            if (finalScore >= 5000) return 'âœ¨ FANTASTIC â€” ç´ æ™´ã‚‰ã—ã„é›†ä¸­åŠ›';
            if (finalScore >= 3000) return 'ğŸ‘ GREAT â€” ã‹ãªã‚Šè‰¯ã„ã‚¹ã‚³ã‚¢';
            if (finalScore >= 1500) return 'ğŸ’ª GOOD â€” ã¾ã ä¼¸ã³ã—ã‚ãŒã‚ã‚Šãã†';
            if (finalScore >= 500) return 'ğŸ’¨ NOT BAD â€” ã‚¦ã‚©ãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒƒãƒ—æ¸ˆ';
            if (finalScore >= 0) return 'ğŸ˜… TRY AGAIN â€” ã¾ã æœ¬æ°—ã˜ã‚ƒãªã„ã‹ã‚‚';
            return 'ğŸ’€ DISASTER â€” é€†ã«ã©ã†ã‚„ã£ãŸã‚“ã â€¦ï¼Ÿ';
        }

        // =====================================================
        // â‘­ é›²ã®è£…é£¾
        // =====================================================

        function spawnCloud() {
            const cloud = document.createElement('div');
            cloud.className = 'cloud';
            const width = randomBetween(120, 250);
            const height = width * 0.4;
            cloud.style.width = width + 'px';
            cloud.style.height = height + 'px';
            cloud.style.top = randomBetween(5, 45) + '%';
            cloud.style.left = '-250px';
            cloud.style.animationDuration = randomBetween(25, 50) + 's';

            const bumps = [
                { w: height * 1.2, h: height * 1.2, l: '10%', t: '-40%' },
                { w: height * 0.9, h: height * 0.9, l: '45%', t: '-30%' },
            ];
            bumps.forEach(b => {
                const bump = document.createElement('div');
                bump.style.cssText = `
          position:absolute; width:${b.w}px; height:${b.h}px;
          background:white; border-radius:50%;
          left:${b.l}; top:${b.t};
        `;
                cloud.appendChild(bump);
            });

            document.body.appendChild(cloud);
            cloud.addEventListener('animationend', () => cloud.remove(), { once: true });
        }

        // =====================================================
        // â‘® ã‚²ãƒ¼ãƒ ã®é–‹å§‹ãƒ»åˆæœŸåŒ–
        // =====================================================

        /**
         * ã‚²ãƒ¼ãƒ ã‚’ï¼ˆå†ï¼‰ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹
         * ã€Œã¯ã˜ã‚ã‚‹ã€ã€Œã‚‚ã†ã„ã¡ã©ã‚ãã¶ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«å‘¼ã¶
         */
        function startGame() {
            // == é€£ç¶šã‚¿ãƒƒãƒ—ãƒã‚°é˜²æ­¢ ==
            // æ—¢ã«ã‚²ãƒ¼ãƒ ãŒèµ°ã£ã¦ã„ã‚‹ãƒ»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ãŒå›ã£ã¦ã„ã‚‹å ´åˆã¯ã€äºŒé‡èµ·å‹•ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã™ã‚‹
            if (gameRunning) return;
            if (animationId) cancelAnimationFrame(animationId);
            if (spawnTimer) clearInterval(spawnTimer);
            if (countdownTimer) clearInterval(countdownTimer);
            // ã‚¿ã‚¤ãƒˆãƒ«ãƒ»çµæœã®ä¸¡ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’éš ã™
            document.getElementById('titleOverlay').style.display = 'none';
            document.getElementById('resultOverlay').style.display = 'none';
            clearStars();

            // ã‚¿ã‚¤ãƒãƒ¼ã®è­¦å‘Šã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('timerBoard').classList.remove('danger');

            // ã‚¹ã‚³ã‚¢ã‚’ãƒªã‚»ãƒƒãƒˆ
            score = 0;
            document.getElementById('scoreValue').textContent = '00000';

            // æ®‹ã£ã¦ã„ã‚‹é¢¨èˆ¹ã‚’æ¶ˆã™ï¼ˆå†ãƒ—ãƒ¬ã‚¤æ™‚ï¼‰
            balloons.forEach(b => b.el.remove());
            balloons = [];
            frame = 0;

            // ãƒ•ã‚£ãƒ¼ãƒãƒ¼çŠ¶æ…‹ãƒ»ãƒ¬ã‚¢ã‚¢ã‚¤ãƒ†ãƒ å‡ºç¾çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            feverActive = false;
            superRareSpawned = false;
            feverTimeElapsed = 0;
            document.body.classList.remove('fever');
            const oldCd = document.getElementById('feverCountdown');
            if (oldCd) oldCd.remove();
            const oldBanner = document.getElementById('feverBanner');
            if (oldBanner) oldBanner.remove();

            // èƒŒæ™¯ã¨transitioné€Ÿåº¦ã‚’é’ç©ºå‘ã‘ã«ãƒªã‚»ãƒƒãƒˆ
            // ç©ºã«è¨­å®š('')ã™ã‚‹ã¨Chromeã®æŒ™å‹•ã§çœŸã£ç™½ã«ãªã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚ã€æ˜ç¤ºçš„ã«ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŒ‡å®š
            document.body.style.transition = 'background-image 1.2s ease';
            document.body.style.backgroundImage = 'linear-gradient(to bottom, #5bbfed 0%, #87d8f5 45%, #c9eeff 100%)';

            gameRunning = true;

            // é¢¨èˆ¹ã‚’å®šæœŸçš„ã«ç”Ÿæˆã™ã‚‹ã‚¿ã‚¤ãƒãƒ¼ã‚’é–‹å§‹
            spawnTimer = setInterval(spawnBalloon, SPAWN_INTERVAL_MS);
            spawnBalloon(); // æœ€åˆã®é¢¨èˆ¹ã‚’ã™ãå‡ºã™

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—ã‚’é–‹å§‹
            animationId = requestAnimationFrame(gameLoop);

            // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã‚’é–‹å§‹ï¼ˆæ–°æ©Ÿèƒ½â‘ ï¼‰
            startCountdown();

            // é›²ã®è£…é£¾ã‚’å®šæœŸç”Ÿæˆ
            setInterval(spawnCloud, 8000);
            spawnCloud();
        }

        // =====================================================
        // â‘¯ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®ç™»éŒ²
        // =====================================================

        // ã€Œã¯ã˜ã‚ã‚‹ã€ãƒœã‚¿ãƒ³
        document.getElementById('startBtn').addEventListener('pointerdown', (e) => {
            e.preventDefault(); // ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ–ãƒªãƒ³ã‚°ã¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚ºãƒ¼ãƒ ç­‰ã‚’é˜²ã
            initAudio(); // ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶é™ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œå¾Œã«åˆæœŸåŒ–
            startGame();
        });

        // ã€Œã‚‚ã†ã„ã¡ã©ã‚ãã¶ã€ãƒœã‚¿ãƒ³ï¼ˆæ–°æ©Ÿèƒ½â‘¡ï¼‰
        document.getElementById('retryBtn').addEventListener('pointerdown', (e) => {
            e.preventDefault();
            initAudio();
            startGame();
        });

        // =====================================================
        // â‘° Safariç­‰ã®ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ ãƒ»ãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ å…¨ä½“é˜²æ­¢
        // =====================================================

        // ç”»é¢å…¨ä½“ã¸ã®ç„¡é–¢ä¿‚ãªã‚¿ãƒƒãƒ—ã§ã®ã‚ºãƒ¼ãƒ ï¼ˆèƒŒæ™¯ã‚„ç«¯ã®ã‚¿ãƒƒãƒ—ï¼‰ã‚’é˜²æ­¢ã™ã‚‹
        document.addEventListener('touchstart', (e) => {
            // ãƒœã‚¿ãƒ³ä»¥å¤–ã®å ´æ‰€ã‚’ã‚¿ãƒƒãƒã—ãŸæ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æŒ™å‹•ï¼ˆã‚ºãƒ¼ãƒ ã‚„ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼‰ã‚’æ­¢ã‚ã‚‹
            if (e.target.tagName !== 'BUTTON') {
                e.preventDefault();
            }
            if (e.touches.length > 1) {
                e.preventDefault(); // 2æœ¬æŒ‡ä»¥ä¸Šã®æ“ä½œï¼ˆãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ï¼‰ã‚’ç¦æ­¢
            }
        }, { passive: false });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', (e) => {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                e.preventDefault(); // 300msä»¥å†…ã®é€£ç¶šã‚¿ãƒƒãƒ—ï¼ˆãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—ã‚ºãƒ¼ãƒ ï¼‰ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            }
            lastTouchEnd = now;
        }, { passive: false });

        // iOS Safari ç‰¹æœ‰ã®ãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆgesturestart, gesturechangeï¼‰ã‚’å¼·åˆ¶ãƒ–ãƒ­ãƒƒã‚¯
        document.addEventListener('gesturestart', (e) => {
            e.preventDefault();
        }, { passive: false });

        document.addEventListener('gesturechange', (e) => {
            e.preventDefault();
        }, { passive: false });

        // ãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ã‚„ãƒ•ãƒªãƒƒã‚¯ãªã©ã®ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚’å¼·åˆ¶çš„ã«ç„¡åŠ¹åŒ–
        // ç”»é¢å…¨ä½“ãŒå›ºå®šã®ã‚²ãƒ¼ãƒ ãªã®ã§ã€touchmove ã‚’å…¨ã¦ãƒ–ãƒ­ãƒƒã‚¯ã—ã¦ã‚‚å•é¡Œãªã„
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        }, { passive: false });

    </script>
</body>

</html>